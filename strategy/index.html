<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCAS | Financial Model</title>
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* ===== REFINED PALETTE ===== */
            --brand: #deff9a;
            --brand-muted: #e8f5c8;
            --brand-text: #4a5d23;
            
            /* ===== NEUTRALS ===== */
            --gray-50: #fafafa;
            --gray-100: #f4f4f5;
            --gray-200: #e4e4e7;
            --gray-300: #d4d4d8;
            --gray-400: #a1a1aa;
            --gray-500: #71717a;
            --gray-600: #52525b;
            --gray-700: #3f3f46;
            --gray-800: #27272a;
            --gray-900: #18181b;
            
            /* ===== SEMANTIC COLORS ===== */
            --green-50: #f0fdf4;
            --green-100: #dcfce7;
            --green-400: #4ade80;
            --green-500: #22c55e;
            --green-600: #16a34a;
            --green-700: #15803d;
            
            --amber-50: #fffbeb;
            --amber-100: #fef3c7;
            --amber-400: #fbbf24;
            --amber-500: #f59e0b;
            --amber-600: #d97706;
            
            --red-50: #fef2f2;
            --red-100: #fee2e2;
            --red-400: #f87171;
            --red-500: #ef4444;
            --red-600: #dc2626;
            
            --blue-50: #eff6ff;
            --blue-100: #dbeafe;
            --blue-500: #3b82f6;
            --blue-600: #2563eb;
            
            /* ===== MAPPED SEMANTIC TOKENS ===== */
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --text-tertiary: var(--gray-400);
            
            --bg-body: var(--gray-50);
            --bg-card: #fff;
            --bg-input: var(--gray-100);
            --bg-hover: var(--gray-50);
            
            --border-default: var(--gray-200);
            --border-light: var(--gray-100);
            
            /* ===== ACCENT COLORS ===== */
            --purple: #7c3aed;
            --purple-bg: rgba(124, 58, 237, 0.08);
            --purple-border: rgba(124, 58, 237, 0.3);
            
            --lime: #deff9a;
            --lime-subtle: rgba(222, 255, 154, 0.25);
            --lime-border: rgba(222, 255, 154, 0.6);
            --lime-text: #3f6212;
            --lime-dark: #365314;
            
            /* ===== STATUS COLORS ===== */
            --positive: #22c55e;
            --positive-bg: #dcfce7;
            --positive-border: #bbf7d0;
            
            --negative: #ef4444;
            --negative-bg: #fee2e2;
            --negative-border: #fecaca;
            
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
            --warning-border: #fde68a;
            
            /* ===== SHADOWS ===== */
            --shadow-xs: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.12);
            
            /* ===== LAYOUT ===== */
            --sidebar-width: 320px;
            --header-height: 56px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }
        
        .mono { font-family: 'JetBrains Mono', 'SF Mono', monospace; }
        
        /* ===== HEADER ===== */
        .header {
            height: var(--header-height);
            background: #fff;
            border-bottom: 1px solid var(--gray-200);
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            padding: 0 24px;
        }
        
        .header-inner {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-logo { 
            font-size: 15px; 
            font-weight: 700; 
            color: var(--gray-900);
            text-decoration: none; 
            letter-spacing: -0.01em;
        }
        
        .header-divider {
            width: 1px;
            height: 16px;
            background: var(--gray-200);
        }
        
        .header-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-500);
        }
        
        .header-badge {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 0.02em;
            color: var(--gray-500);
            background: var(--gray-100);
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .header-badge.validated {
            color: var(--green-700);
            background: var(--green-50);
        }
        
        .model-toggle {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
        }
        
        .model-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            font-family: inherit;
            color: var(--gray-500);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .model-btn:hover { color: var(--gray-700); }
        
        .model-btn.active {
            background: #fff;
            color: var(--gray-900);
            box-shadow: var(--shadow-sm);
        }
        
        .layout {
            display: flex;
            padding-top: var(--header-height);
            min-height: 100vh;
        }
        
        .main-content {
            flex: 1;
            padding: 32px;
            margin-right: var(--sidebar-width);
            max-width: calc(100% - var(--sidebar-width));
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            border-left: 1px solid var(--gray-200);
            position: fixed;
            top: var(--header-height);
            right: 0;
            bottom: 0;
            overflow-y: auto;
            padding: 24px 20px;
        }
        
        .sidebar-header { margin-bottom: 24px; }
        
        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sidebar-section { margin-bottom: 28px; }
        
        .sidebar-section h4 {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--gray-400);
            margin-bottom: 14px;
        }
        
        .sidebar-section h4::after {
            display: none;
        }
        
        /* ===== KEY ASSUMPTIONS BANNER ===== */
        .validation-banner {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .validation-icon {
            width: 32px;
            height: 32px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .validation-content { 
            flex: 1; 
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .validation-title {
            font-size: 11px;
            font-weight: 500;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        
        .validation-subtitle {
            font-size: 12px;
            color: var(--gray-500);
            margin-bottom: 12px;
        }
        
        .validation-changes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .validation-change {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .validation-change:hover {
            background: var(--gray-200);
        }
        
        .validation-change .old {
            color: var(--gray-400);
            text-decoration: line-through;
        }
        
        .validation-change .arrow { color: var(--gray-400); }
        
        .validation-change .new {
            color: var(--gray-700);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }
        
        /* ===== SCENARIO TOGGLE ===== */
        .scenario-toggle {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .scenario-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 14px 8px;
            background: #fff;
            border: 1.5px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .scenario-btn:hover { 
            border-color: var(--gray-300);
            background: var(--gray-50);
        }
        
        .scenario-btn.active {
            background: rgba(222, 255, 154, 0.15);
            border-color: var(--brand);
            border-width: 2px;
        }
        
        .scenario-btn.active .scenario-label {
            color: var(--brand-text);
        }
        
        .scenario-btn.active .scenario-icon {
            filter: none;
        }
        
        .scenario-btn[data-scenario="bear"].active {
            background: var(--red-50);
            border-color: var(--red-400);
        }
        
        .scenario-btn[data-scenario="bear"].active .scenario-label {
            color: var(--red-600);
        }
        
        .scenario-btn[data-scenario="bear"].active .scenario-icon {
            filter: none;
        }
        
        .scenario-btn[data-scenario="bull"].active {
            background: var(--green-50);
            border-color: var(--green-400);
        }
        
        .scenario-btn[data-scenario="bull"].active .scenario-label {
            color: var(--green-600);
        }
        
        .scenario-btn[data-scenario="bull"].active .scenario-icon {
            filter: none;
        }
        
        .scenario-icon { font-size: 20px; }
        .scenario-label { font-size: 11px; font-weight: 600; color: var(--gray-500); transition: all 0.15s; }
        
        .scenario-description {
            font-size: 12px;
            color: var(--gray-500);
            line-height: 1.5;
            padding: 10px 12px;
            background: var(--gray-50);
            border-radius: var(--radius-sm);
        }
        
        /* ===== PRICE GRID ===== */
        .price-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }
        
        .price-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 6px;
            background: #fff;
            border: 1.5px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
        }
        
        .price-btn:hover { 
            border-color: var(--gray-300);
            background: var(--gray-50);
        }
        
        .price-btn.active {
            background: rgba(222, 255, 154, 0.15);
            border-color: var(--brand);
            border-width: 2px;
        }
        
        .price-btn.recommended::after {
            content: 'âœ“';
            position: absolute;
            top: -6px;
            right: -6px;
            width: 18px;
            height: 18px;
            background: #7c3aed;
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .price-btn .num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .price-btn.active .num { color: var(--brand-text); }
        
        .price-btn .label {
            font-size: 10px;
            color: var(--gray-400);
            margin-top: 2px;
            font-weight: 500;
        }
        
        .price-btn.active .label { color: var(--brand-text); }
        
        /* ===== SLIDERS ===== */
        .slider-group { margin-bottom: 20px; }
        .slider-group:last-child { margin-bottom: 0; }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .slider-header label {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .slider-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: #7c3aed;
            background: rgba(124, 58, 237, 0.1);
            padding: 4px 10px;
            border-radius: 6px;
            border: 1px solid rgba(124, 58, 237, 0.2);
        }
        
        .slider-value.validated {
            color: var(--blue-600);
            background: var(--blue-50);
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            cursor: pointer;
            border: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--brand);
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.15s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(222, 255, 154, 0.5);
        }
        
        .slider-hint {
            font-size: 12px;
            color: var(--gray-400);
            margin-top: 8px;
        }
        
        .slider-hint.research {
            color: #10b981;
            font-weight: 500;
        }
        
        /* ===== EXECUTIVE SUMMARY ===== */
        .executive-summary {
            position: relative;
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px 28px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 28px;
        }
        
        .executive-summary::before {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0;
            width: 4px;
            background: var(--brand);
            border-radius: 4px 0 0 4px;
        }
        
        .executive-summary.bear::before { background: var(--red-500); }
        .executive-summary.bull::before { background: var(--green-500); }
        
        .summary-main { flex: 1; min-width: 0; }
        
        .summary-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-500);
            margin-bottom: 8px;
        }
        
        .summary-insight {
            font-size: 15px;
            font-weight: 400;
            line-height: 1.6;
            color: var(--gray-600);
        }
        
        .summary-insight strong {
            font-weight: 700;
            color: var(--brand-text);
            background: var(--brand);
            padding: 2px 8px;
            border-radius: 4px;
        }
        
        .summary-kpis {
            display: flex;
            gap: 24px;
            flex-shrink: 0;
        }
        
        .summary-kpi {
            text-align: center;
            padding: 0 20px;
            border-left: 1px solid var(--gray-200);
        }
        
        .summary-kpi:first-child { border-left: none; padding-left: 0; }
        
        .summary-kpi-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 22px;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .summary-kpi-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--gray-400);
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        
        /* ===== COMPARISON VS ORIGINAL ===== */
        .comparison-strip {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .comparison-card {
            flex: 1;
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 14px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .comparison-card.original {
            opacity: 0.5;
        }
        
        .comparison-card.validated {
            border-color: var(--gray-300);
            background: #fff;
        }
        
        .comparison-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--gray-400);
        }
        
        .comparison-card.validated .comparison-label { color: var(--gray-600); }
        
        .comparison-metrics {
            display: flex;
            gap: 20px;
            flex: 1;
        }
        
        .comparison-metric { text-align: center; }
        
        .comparison-metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .comparison-metric-label {
            font-size: 10px;
            color: var(--gray-400);
        }
        
        .comparison-delta {
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .comparison-delta.down {
            background: var(--amber-50);
            color: var(--amber-600);
        }
        
        .comparison-delta.realistic {
            background: var(--green-50);
            color: var(--green-600);
        }
        
        /* ===== KEY RATIOS ===== */
        .ratios-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .ratio-card {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .ratio-card:hover {
            border-color: var(--gray-300);
        }
        
        .ratio-card.success { border-left: 3px solid var(--green-500); }
        .ratio-card.warning { border-left: 3px solid var(--amber-500); }
        .ratio-card.danger { border-left: 3px solid var(--red-500); }
        
        .ratio-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .ratio-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--gray-500);
        }
        
        .ratio-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gray-300);
        }
        
        .ratio-card.success .ratio-status { background: var(--green-500); }
        .ratio-card.warning .ratio-status { background: var(--amber-500); }
        .ratio-card.danger .ratio-status { background: var(--red-500); }
        
        .ratio-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .ratio-card.success .ratio-value { color: var(--green-600); }
        .ratio-card.danger .ratio-value { color: var(--red-600); }
        
        .ratio-target {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .ratio-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gray-100);
        }
        
        .ratio-bar-fill {
            height: 100%;
            background: var(--gray-300);
            transition: width 0.3s ease;
        }
        
        .ratio-card.success .ratio-bar-fill { background: var(--green-500); }
        .ratio-card.warning .ratio-bar-fill { background: var(--amber-500); }
        .ratio-card.danger .ratio-bar-fill { background: var(--red-500); }
        
        /* ===== VALIDATION GAPS ===== */
        .validation-gaps {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .validation-gaps-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .validation-gaps-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .validation-gaps-subtitle {
            font-size: 12px;
            color: var(--gray-400);
        }
        
        .gap-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .gap-item {
            padding: 14px;
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            border-left: 2px solid var(--amber-500);
        }
        
        .gap-item.validated {
            border-left-color: var(--green-500);
            background: var(--green-50);
        }
        
        .gap-item.critical {
            border-left-color: var(--red-500);
            background: var(--red-50);
        }
        
        .gap-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }
        
        .gap-status {
            font-size: 11px;
            color: var(--gray-500);
        }
        
        .gap-item.validated .gap-status { color: var(--green-600); }
        .gap-item.critical .gap-status { color: var(--red-600); }
        
        /* ===== MILESTONES ===== */
        .milestones-card {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            margin-bottom: 20px;
        }
        
        .milestones-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .milestones-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .milestones-subtitle {
            font-size: 11px;
            color: var(--gray-400);
        }
        
        .milestone-track {
            display: flex;
            align-items: flex-start;
            gap: 0;
            position: relative;
        }
        
        .milestone-track::before {
            content: '';
            position: absolute;
            top: 14px;
            left: 14px;
            right: 14px;
            height: 1px;
            background: var(--gray-200);
            z-index: 0;
        }
        
        .milestone {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .milestone-node {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #fff;
            border: 2px solid var(--gray-300);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-400);
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        
        .milestone.on-track .milestone-node {
            border-color: var(--green-500);
            color: var(--green-600);
            background: var(--green-50);
        }
        
        .milestone.at-risk .milestone-node {
            border-color: var(--amber-500);
            color: var(--amber-600);
            background: var(--amber-50);
        }
        
        .milestone.off-track .milestone-node {
            border-color: var(--red-500);
            color: var(--red-600);
            background: var(--red-50);
        }
        
        .milestone-content { max-width: 100px; }
        
        .milestone-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .milestone-projected {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 1px;
        }
        
        .milestone-projected strong {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--lime-text);
        }
        
        .milestone.at-risk .milestone-projected strong { color: var(--warning); }
        .milestone.off-track .milestone-projected strong { color: var(--negative); }
        
        .milestone-vs {
            font-size: 9px;
            color: var(--text-tertiary);
            margin-bottom: 1px;
        }
        
        .milestone-vs span { font-family: 'JetBrains Mono', monospace; }
        
        .milestone-kill {
            font-size: 9px;
            color: var(--text-tertiary);
        }
        
        .milestone-kill strong {
            color: var(--negative);
            font-weight: 600;
        }
        
        /* ===== CHARTS ===== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .chart-card {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
        }
        
        .chart-card:hover {
            border-color: var(--gray-300);
        }
        
        .chart-header { margin-bottom: 16px; }
        
        .chart-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 2px;
        }
        
        .chart-subtitle {
            font-size: 11px;
            color: var(--gray-400);
        }
        
        .chart-container {
            height: 200px;
            position: relative;
        }
        
        /* ===== DATA CARDS ===== */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .data-card {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 20px;
        }
        
        .data-card:hover {
            border-color: var(--gray-300);
        }
        
        .data-card-header { margin-bottom: 16px; }
        
        .data-card-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 2px;
        }
        
        .data-card-subtitle {
            font-size: 11px;
            color: var(--gray-400);
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .data-row:last-child { border-bottom: none; }
        
        .data-row.total {
            margin-top: 6px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-300);
            border-bottom: none;
        }
        
        .data-row-label {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .data-row-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .data-row.negative .data-row-value { color: var(--gray-400); }
        
        .data-row.total .data-row-label,
        .data-row.total .data-row-value {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        /* ===== P&L TABLE ===== */
        .pnl-section {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .pnl-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .pnl-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .pnl-subtitle {
            font-size: 11px;
            color: var(--gray-400);
        }
        
        .export-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-input);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .export-btn:hover {
            background: var(--lime-subtle);
            border-color: var(--lime);
            color: var(--lime-text);
        }
        
        .pnl-table-wrap { overflow-x: auto; }
        
        .pnl-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .pnl-table th,
        .pnl-table td {
            padding: 12px 14px;
            text-align: right;
            white-space: nowrap;
        }
        
        .pnl-table th:first-child,
        .pnl-table td:first-child {
            text-align: left;
            position: sticky;
            left: 0;
            background: #fff;
            z-index: 1;
        }
        
        .pnl-table thead th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            font-size: 10px;
        }
        
        .pnl-table tbody tr { border-top: 1px solid var(--gray-100); }
        .pnl-table tbody tr:hover { background: var(--gray-50); }
        
        .pnl-table .row-label { font-weight: 500; color: var(--gray-600); }
        .pnl-table .positive { color: #16a34a; font-weight: 600; }
        .pnl-table .negative { color: #dc2626; font-weight: 600; }
        
        .pnl-table .total-row { background: var(--gray-100); font-weight: 700; }
        .pnl-table .total-row td { color: var(--gray-900); }
        
        .pnl-table .subtotal-row { background: rgba(222, 255, 154, 0.2); }
        .pnl-table .subtotal-row td:first-child { background: rgba(222, 255, 154, 0.2); }
        
        /* ===== SCENARIO COMPARISON ===== */
        .section { margin-bottom: 24px; }
        .section-header { margin-bottom: 16px; }
        
        .section-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .section-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .table-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .comparison-table th {
            padding: 14px 20px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            background: var(--bg-input);
            text-align: center;
        }
        
        .comparison-table th:first-child { text-align: left; }
        
        .comparison-table th.recommended {
            color: var(--lime-text);
            background: var(--lime-subtle);
        }
        
        .comparison-table th.bear-col {
            color: #dc2626;
            background: rgba(239,68,68,0.08);
        }
        
        .comparison-table th.base-col {
            color: var(--purple);
            background: var(--purple-bg);
        }
        
        .comparison-table th.bull-col {
            color: #16a34a;
            background: rgba(34,197,94,0.08);
        }
        
        .rec-badge {
            display: inline-block;
            font-size: 8px;
            font-weight: 700;
            background: var(--purple);
            color: white;
            padding: 3px 8px;
            border-radius: 100px;
            margin-left: 8px;
        }
        
        .comparison-table td {
            padding: 14px 20px;
            text-align: center;
            border-top: 1px solid var(--border-light);
        }
        
        .comparison-table td:first-child {
            text-align: left;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .comparison-table td.recommended { background: rgba(222,255,154,0.05); }
        .comparison-table td.bear-col { background: rgba(239,68,68,0.03); }
        .comparison-table td.base-col { background: rgba(139,92,246,0.03); }
        .comparison-table td.bull-col { background: rgba(34,197,94,0.03); }
        
        .comparison-table .value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }
        
        .comparison-table .value.positive { color: var(--positive); }
        .comparison-table .value.negative { color: var(--negative); }
        
        .verdict-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .verdict-tag.success { background: rgba(34,197,94,0.12); color: #16a34a; }
        .verdict-tag.danger { background: rgba(239,68,68,0.12); color: #dc2626; }
        .verdict-tag.warning { background: rgba(245,158,11,0.12); color: #d97706; }
        
        /* ===== 3-YEAR PROJECTION ===== */
        .projection-section {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
        }
        
        .projection-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        
        .projection-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .projection-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        
        .projection-toggle {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--bg-input);
            border-radius: var(--radius-sm);
        }
        
        .proj-view-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .proj-view-btn:hover { color: var(--text-primary); }
        
        .proj-view-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .projection-content.hidden { display: none; }
        
        /* Year Cards */
        .year-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .year-card {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .year-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .year-card.year-1 {
            background: linear-gradient(135deg, rgba(139,92,246,0.12) 0%, rgba(139,92,246,0.04) 100%);
            border: 1px solid var(--purple-border);
        }
        
        .year-card.year-2 {
            background: linear-gradient(135deg, rgba(222,255,154,0.15) 0%, rgba(222,255,154,0.05) 100%);
            border: 1px solid var(--lime-border);
        }
        
        .year-card.year-3 {
            background: linear-gradient(135deg, rgba(34,197,94,0.12) 0%, rgba(34,197,94,0.04) 100%);
            border: 1px solid rgba(34,197,94,0.25);
        }
        
        .year-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 4px 10px;
            border-radius: 100px;
            margin-bottom: 8px;
        }
        
        .year-1 .year-badge { background: var(--purple); color: white; }
        .year-2 .year-badge { background: var(--lime); color: var(--lime-text); }
        .year-3 .year-badge { background: rgba(34,197,94,0.2); color: #16a34a; }
        
        .year-phase {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        
        .year-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .year-metric {
            display: flex;
            flex-direction: column;
        }
        
        .year-metric.primary {
            grid-column: span 2;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            margin-bottom: 4px;
        }
        
        .year-metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .year-metric.primary .year-metric-value { font-size: 22px; }
        
        .year-1 .year-metric.primary .year-metric-value { color: var(--purple); }
        .year-2 .year-metric.primary .year-metric-value { color: var(--lime-text); }
        .year-3 .year-metric.primary .year-metric-value { color: #16a34a; }
        
        .year-metric-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .year-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(0,0,0,0.05);
        }
        
        .year-bar-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .year-1 .year-bar-fill { background: var(--purple); width: 25%; }
        .year-2 .year-bar-fill { background: var(--lime-dark); width: 50%; }
        .year-3 .year-bar-fill { background: #22c55e; width: 100%; }
        
        /* Projection Chart */
        .projection-chart-container {
            height: 200px;
            margin-bottom: 20px;
        }
        
        /* Valuation Strip */
        .valuation-strip {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--bg-input) 0%, var(--bg-body) 100%);
            border-radius: var(--radius-md);
            border: 1px dashed var(--border-default);
        }
        
        .valuation-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .valuation-item.highlight {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--purple-bg) 0%, rgba(139,92,246,0.15) 100%);
            border: 1px solid var(--purple-border);
            border-radius: var(--radius-sm);
        }
        
        .valuation-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            margin-bottom: 2px;
        }
        
        .valuation-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .valuation-item.highlight .valuation-value {
            font-size: 22px;
            color: var(--purple);
        }
        
        .valuation-divider {
            font-size: 18px;
            font-weight: 300;
            color: var(--text-tertiary);
        }
        
        /* Detailed View */
        .projection-assumptions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .assumption-group {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 20px;
        }
        
        .assumption-group h5 {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
        }
        
        .assumption-row { margin-bottom: 14px; }
        .assumption-row:last-child { margin-bottom: 0; }
        
        .assumption-row label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        
        .assumption-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .assumption-control input[type="range"] { flex: 1; }
        
        .assumption-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            color: var(--purple);
            background: var(--purple-bg);
            padding: 3px 8px;
            border-radius: 4px;
            min-width: 55px;
            text-align: center;
        }
        
        /* Projection Table */
        .projection-table-wrap { overflow-x: auto; }
        
        .projection-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .projection-table th,
        .projection-table td {
            padding: 14px 16px;
            text-align: right;
        }
        
        .projection-table th:first-child,
        .projection-table td:first-child { text-align: left; }
        
        .projection-table thead th {
            background: var(--bg-input);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--text-secondary);
        }
        
        .projection-table thead th:nth-child(2) { color: var(--purple); }
        .projection-table thead th:nth-child(3) { color: var(--lime-text); }
        .projection-table thead th:nth-child(4) { color: #16a34a; }
        
        .projection-table tbody tr { border-top: 1px solid var(--border-light); }
        .projection-table tbody tr:hover { background: var(--bg-hover); }
        
        .projection-table td {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }
        
        .projection-table td:first-child {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .projection-table .total-row { background: var(--bg-input); font-weight: 700; }
        .projection-table .positive { color: var(--positive); }
        .projection-table .negative { color: var(--negative); }
        
        @media (max-width: 900px) {
            .year-cards { grid-template-columns: 1fr; }
            .projection-assumptions { grid-template-columns: 1fr; }
            .valuation-strip { flex-wrap: wrap; gap: 12px; }
        }
        
        /* ===== GROWTH SUMMARY ===== */
        .growth-summary {
            margin-top: 14px;
            padding: 14px;
            background: linear-gradient(135deg, var(--lime-subtle) 0%, transparent 100%);
            border: 1px solid var(--lime-border);
            border-radius: var(--radius-sm);
        }
        
        .growth-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .growth-summary-item { text-align: center; flex: 1; }
        
        .growth-summary-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
        }
        
        .growth-summary-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .growth-summary-total {
            text-align: center;
            padding-top: 10px;
            border-top: 1px solid var(--lime-border);
        }
        
        .growth-summary-total .growth-summary-value {
            font-size: 22px;
            color: var(--lime-text);
        }
        
        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            padding: 24px;
            color: var(--gray-400);
            font-size: 12px;
            border-top: 1px solid var(--gray-200);
            background: #fff;
        }
        
        .footer span {
            color: var(--gray-600);
            font-weight: 600;
        }
        
        /* ===== MOBILE ===== */
        .mobile-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gray-900);
            border: none;
            font-size: 18px;
            cursor: pointer;
            z-index: 200;
            box-shadow: var(--shadow-lg);
            color: #fff;
        }
        
        @media (max-width: 1100px) {
            .ratios-grid { grid-template-columns: repeat(2, 1fr); }
            .milestone-track { flex-wrap: wrap; gap: 20px; }
            .milestone-track::before { display: none; }
            .gap-grid { grid-template-columns: repeat(2, 1fr); }
            .comparison-strip { flex-direction: column; }
        }
        
        @media (max-width: 900px) {
            .main-content { margin-right: 0; max-width: 100%; padding: 20px; }
            .sidebar { display: none; }
            .sidebar.open { display: block; position: fixed; top: var(--header-height); left: 0; right: 0; bottom: 0; width: 100%; z-index: 150; }
            .mobile-toggle { display: flex; align-items: center; justify-content: center; }
            .model-toggle { display: none; }
            .charts-grid, .data-grid { grid-template-columns: 1fr; }
            .ratios-grid { grid-template-columns: repeat(2, 1fr); }
            .executive-summary { flex-direction: column; align-items: flex-start; gap: 16px; }
            .summary-kpis { width: 100%; justify-content: flex-start; flex-wrap: wrap; }
            .gap-grid { grid-template-columns: 1fr; }
        }
        
        /* ===== DECISION BOX ===== */
        .decision-box {
            position: relative;
            background: #fff;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
        }
        
        .decision-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gray-900);
        }
        
        .decision-box.go::before {
            background: var(--green-500);
        }
        
        .decision-box.conditional::before {
            background: var(--amber-500);
        }
        
        .decision-box.nogo::before {
            background: var(--red-500);
        }
        
        .decision-box-inner {
            display: grid;
            grid-template-columns: 160px 1fr 160px;
            min-height: 100px;
        }
        
        .decision-verdict {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-right: 1px solid var(--gray-100);
            background: var(--gray-50);
        }
        
        .decision-box.go .decision-verdict {
            background: var(--green-50);
        }
        
        .decision-box.conditional .decision-verdict {
            background: var(--amber-50);
        }
        
        .decision-box.nogo .decision-verdict {
            background: var(--red-50);
        }
        
        .verdict-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--gray-400);
            margin-bottom: 6px;
        }
        
        .verdict-status {
            font-size: 20px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }
        
        .decision-box.go .verdict-status { color: var(--green-600); }
        .decision-box.conditional .verdict-status { color: var(--amber-600); }
        .decision-box.nogo .verdict-status { color: var(--red-600); }
        
        .verdict-subtitle {
            font-size: 11px;
            color: var(--gray-500);
            font-weight: 500;
        }
        
        .decision-conditions {
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .conditions-title {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--gray-400);
            margin-bottom: 10px;
        }
        
        .condition-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 16px;
        }
        
        .condition-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-600);
        }
        
        .condition-check {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        
        .condition-item.pending .condition-check {
            background: var(--gray-100);
            border: 1.5px solid var(--border-default);
            color: transparent;
        }
        
        .condition-item.met .condition-check {
            background: var(--positive);
            border: 1.5px solid var(--positive);
            color: white;
        }
        
        .condition-item.at-risk .condition-check {
            background: var(--warning-bg);
            border: 1.5px solid var(--warning);
            color: var(--warning);
        }
        
        .decision-funding {
            padding: 14px 20px;
            background: var(--bg-input);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .funding-label {
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-tertiary);
            margin-bottom: 4px;
        }
        
        .funding-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }
        
        .funding-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .funding-detail {
            font-size: 9px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .funding-detail-icon {
            font-size: 10px;
        }
        
        /* ===== BREAKEVEN HERO ===== */
        .breakeven-hero {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .breakeven-card {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px;
            position: relative;
            overflow: hidden;
        }
        
        .breakeven-card:hover {
            border-color: var(--gray-300);
        }
        
        .breakeven-card.units {
            background: #fff;
        }
        
        .breakeven-card.units::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #7c3aed;
        }
        
        .breakeven-card.time {
            background: #fff;
        }
        
        .breakeven-card.time::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--brand);
        }
        
        .breakeven-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .breakeven-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: var(--gray-100);
        }
        
        .breakeven-card.units .breakeven-icon {
            background: rgba(124, 58, 237, 0.1);
        }
        
        .breakeven-card.time .breakeven-icon {
            background: rgba(222, 255, 154, 0.3);
        }
        
        .breakeven-tag {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            padding: 5px 10px;
            border-radius: 6px;
            background: var(--gray-100);
            color: var(--gray-600);
        }
        
        .breakeven-card.units .breakeven-tag {
            background: rgba(124, 58, 237, 0.1);
            color: #7c3aed;
        }
        
        .breakeven-card.time .breakeven-tag {
            background: rgba(222, 255, 154, 0.4);
            color: var(--brand-text);
        }
        
        .breakeven-content {
            margin-bottom: 16px;
        }
        
        .breakeven-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-500);
            margin-bottom: 6px;
        }
        
        .breakeven-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
            letter-spacing: -0.02em;
        }
        
        .breakeven-card.units .breakeven-value { color: #7c3aed; }
        .breakeven-card.time .breakeven-value { color: var(--brand-text); }
        
        .breakeven-suffix {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.6;
            margin-left: 4px;
        }
        
        .breakeven-detail {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 8px;
            line-height: 1.5;
        }
        
        .breakeven-formula {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            font-size: 12px;
        }
        
        .formula-label {
            color: var(--gray-500);
            font-weight: 500;
        }
        
        .formula-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            background: #fff;
            padding: 4px 10px;
            border-radius: 6px;
            color: var(--gray-700);
            font-weight: 600;
            border: 1px solid var(--gray-200);
        }
        
        .breakeven-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gray-100);
        }
        
        .breakeven-progress-fill {
            height: 100%;
            transition: width 0.4s ease;
        }
        
        .breakeven-card.units .breakeven-progress-fill { 
            background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);
        }
        .breakeven-card.time .breakeven-progress-fill { 
            background: linear-gradient(90deg, var(--brand-text) 0%, var(--brand) 100%);
        }
        
        /* ===== SENSITIVITY ANALYSIS ===== */
        .sensitivity-section {
            background: #fff;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .sensitivity-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .sensitivity-header-left h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sensitivity-header-left p {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .sensitivity-legend {
            display: flex;
            gap: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 500;
            color: var(--gray-600);
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .legend-dot.negative { background: #f87171; }
        .legend-dot.base { background: var(--gray-800); }
        .legend-dot.positive { background: #4ade80; }
        
        .sensitivity-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .sensitivity-row {
            display: grid;
            grid-template-columns: 120px 1fr 80px;
            gap: 16px;
            align-items: center;
        }
        
        .sensitivity-variable {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .sensitivity-bar-wrap {
            position: relative;
            height: 32px;
            background: var(--gray-100);
            border-radius: 6px;
            overflow: visible;
        }
        
        .sensitivity-bar-center {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background: var(--gray-800);
            z-index: 3;
        }
        
        .sensitivity-bar-center::after {
            content: 'BASE';
            position: absolute;
            top: -14px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            font-weight: 600;
            color: var(--gray-500);
            letter-spacing: 0.04em;
        }
        
        .sensitivity-bar-negative {
            position: absolute;
            top: 5px;
            bottom: 5px;
            right: 50%;
            background: linear-gradient(90deg, #ef4444 0%, #fca5a5 100%);
            border-radius: 4px 0 0 4px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-left: 8px;
            transition: width 0.3s ease;
            overflow: hidden;
        }
        
        .sensitivity-bar-positive {
            position: absolute;
            top: 5px;
            bottom: 5px;
            left: 50%;
            background: linear-gradient(90deg, #86efac 0%, #22c55e 100%);
            border-radius: 0 4px 4px 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            transition: width 0.3s ease;
            overflow: hidden;
        }
        
        .sensitivity-bar-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .sensitivity-impact {
            text-align: center;
        }
        
        .impact-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .impact-badge.critical {
            background: var(--red-100);
            color: var(--red-600);
        }
        
        .impact-badge.high {
            background: var(--amber-100);
            color: var(--amber-600);
        }
        
        .impact-badge.medium {
            background: var(--blue-50);
            color: var(--blue-600);
        }
        
        .impact-badge.low {
            background: var(--green-100);
            color: var(--green-600);
        }
        
        .sensitivity-insight {
            margin-top: 16px;
            padding: 14px 16px;
            background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);
            border: 1px solid #fecaca;
            border-radius: var(--radius-md);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .insight-icon {
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .insight-content h4 {
            font-size: 12px;
            font-weight: 700;
            color: #dc2626;
            margin-bottom: 4px;
        }
        
        .insight-content p {
            font-size: 12px;
            color: var(--gray-600);
            line-height: 1.6;
        }
        
        .insight-content strong {
            color: var(--gray-800);
            font-weight: 600;
        }
        
        @media (max-width: 900px) {
            .decision-box-inner {
                grid-template-columns: 1fr;
            }
            .decision-verdict {
                border-right: none;
                border-bottom: 1px solid var(--gray-200);
                padding: 24px;
            }
            .decision-funding {
                border-top: 1px solid var(--gray-200);
            }
            .breakeven-hero {
                grid-template-columns: 1fr;
            }
            .breakeven-value {
                font-size: 40px;
            }
            .sensitivity-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .sensitivity-bar-wrap {
                height: 36px;
            }
            .sensitivity-bar-center::after {
                display: none;
            }
            .sensitivity-legend {
                display: none;
            }
        }

        /* Monte Carlo Simulation Styles */
        .monte-carlo-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
        }
        .monte-carlo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .monte-carlo-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-800);
        }
        .monte-carlo-subtitle {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: 4px;
        }
        .mc-disclaimer {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .mc-disclaimer-icon {
            font-size: 16px;
            flex-shrink: 0;
        }
        .mc-disclaimer-text {
            font-size: 12px;
            color: #92400e;
            line-height: 1.5;
        }
        .mc-disclaimer-text strong {
            color: #78350f;
        }
        .mc-run-btn {
            background: #1a365d;
            background: linear-gradient(135deg, #1a365d, #2c5282);
            color: #ffffff !important;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.3);
        }
        .mc-run-btn span {
            color: #ffffff !important;
        }
        .mc-run-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.4);
            background: linear-gradient(135deg, #2c5282, #1a365d);
        }
        .mc-run-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .mc-section-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--gray-200);
        }
        .mc-decision-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        .mc-decision-card {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 16px;
        }
        .mc-decision-card.danger {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 1px solid #fecaca;
        }
        .mc-decision-card.success {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 1px solid #bbf7d0;
        }
        .mc-decision-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .mc-decision-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 4px;
        }
        .mc-decision-card.danger .mc-decision-value {
            color: #dc2626;
        }
        .mc-decision-card.success .mc-decision-value {
            color: #16a34a;
        }
        .mc-decision-detail {
            font-size: 12px;
            color: var(--gray-600);
        }
        .mc-decision-action {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(0,0,0,0.1);
            font-size: 11px;
            color: var(--gray-600);
            font-style: italic;
        }
        .mc-results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .mc-result-card {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .mc-result-card.highlight {
            background: linear-gradient(135deg, rgba(26, 54, 93, 0.05), rgba(44, 82, 130, 0.08));
            border: 1px solid rgba(26, 54, 93, 0.15);
        }
        .mc-result-label {
            font-size: 11px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .mc-result-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
        }
        .mc-result-detail {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 4px;
        }
        .mc-charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        .mc-chart-container {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 16px;
        }
        .mc-chart-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 12px;
        }
        .mc-histogram {
            height: 180px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
            padding: 0 4px;
        }
        .mc-bar {
            flex: 1;
            background: var(--brand-primary);
            border-radius: 2px 2px 0 0;
            opacity: 0.7;
            transition: opacity 0.2s;
            min-width: 8px;
        }
        .mc-bar:hover {
            opacity: 1;
        }
        .mc-bar.negative {
            background: var(--red-500);
        }
        .mc-bar.highlight {
            background: var(--green-500);
            opacity: 1;
        }
        .mc-axis {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 10px;
            color: var(--gray-500);
        }
        .mc-percentiles {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
        }
        .mc-percentile {
            text-align: center;
        }
        .mc-percentile-label {
            font-size: 10px;
            color: var(--gray-500);
        }
        .mc-percentile-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
        }
        .mc-probability-bars {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .mc-prob-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .mc-prob-label {
            font-size: 12px;
            color: var(--gray-600);
            width: 140px;
            flex-shrink: 0;
        }
        .mc-prob-bar-bg {
            flex: 1;
            height: 24px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .mc-prob-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .mc-prob-bar-fill.high {
            background: linear-gradient(90deg, var(--green-400), var(--green-500));
        }
        .mc-prob-bar-fill.medium {
            background: linear-gradient(90deg, var(--yellow-400), var(--yellow-500));
        }
        .mc-prob-bar-fill.low {
            background: linear-gradient(90deg, var(--red-400), var(--red-500));
        }
        .mc-prob-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            width: 50px;
            text-align: right;
        }
        .mc-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--gray-500);
        }
        .mc-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--brand-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .mc-stress-section {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }
        .mc-stress-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        .mc-stress-card {
            background: var(--gray-50);
            border-radius: 10px;
            padding: 14px;
        }
        .mc-stress-scenario {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }
        .mc-stress-result {
            font-size: 11px;
            color: var(--gray-600);
            line-height: 1.5;
        }
        .mc-stress-result strong {
            color: var(--gray-800);
        }
        .mc-stress-result.warning strong {
            color: #d97706;
        }
        .mc-stress-result.danger strong {
            color: #dc2626;
        }
        .mc-assumptions-used {
            margin-top: 20px;
            padding: 12px 16px;
            background: var(--gray-50);
            border-radius: 8px;
            font-size: 11px;
            color: var(--gray-500);
        }
        .mc-assumptions-used summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
        }
        .mc-assumptions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px 16px;
            margin-top: 10px;
        }
        .mc-assumption-item {
            display: flex;
            justify-content: space-between;
        }
        .mc-assumption-label {
            color: var(--gray-500);
        }
        .mc-assumption-range {
            color: var(--gray-700);
            font-weight: 500;
        }
        @media (max-width: 768px) {
            .mc-results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .mc-charts-grid {
                grid-template-columns: 1fr;
            }
            .mc-decision-grid {
                grid-template-columns: 1fr;
            }
            .mc-stress-grid {
                grid-template-columns: 1fr;
            }
            .mc-assumptions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="header-left">
                <a href="/" class="header-logo">LUCAS</a>
                <div class="header-divider"></div>
                <span class="header-title">Financial Model</span>
                <span class="header-badge validated">MODEL v1.0</span>
            </div>
        </div>
    </header>

    <div class="layout">
        <main class="main-content">
            <!-- Research Validation Banner -->
            <div class="validation-banner">
                <div class="validation-icon">âš™ï¸</div>
                <div class="validation-content">
                    <div class="validation-title">Key Assumptions</div>
                    <div class="validation-changes">
                        <div class="validation-change">
                            <span class="new" id="assumption-price">AED 350/property</span>
                        </div>
                        <div class="validation-change">
                            <span class="new" id="assumption-units">22 properties/mgr</span>
                        </div>
                        <div class="validation-change">
                            <span class="new" id="assumption-conversion">50% conv</span>
                        </div>
                        <div class="validation-change">
                            <span class="new" id="assumption-churn">8% churn</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DECISION BOX -->
            <div class="decision-box conditional" id="decision-box">
                <div class="decision-box-inner">
                    <div class="decision-verdict">
                        <div class="verdict-label">Investment Verdict</div>
                        <div class="verdict-status" id="verdict-status">CONDITIONAL GO</div>
                        <div class="verdict-subtitle" id="verdict-subtitle">Validate pricing first</div>
                    </div>
                    <div class="decision-conditions">
                        <div class="conditions-title">Conditions to Proceed</div>
                        <div class="condition-list">
                            <div class="condition-item pending" id="cond-1">
                                <div class="condition-check">âœ“</div>
                                <span>Sign 3 pilot property managers by Day 45</span>
                            </div>
                            <div class="condition-item pending" id="cond-2">
                                <div class="condition-check">âœ“</div>
                                <span>Convert 1 to paid at base price by Day 90</span>
                            </div>
                            <div class="condition-item pending" id="cond-3">
                                <div class="condition-check">âœ“</div>
                                <span>Achieve under 8% monthly churn in pilot</span>
                            </div>
                            <div class="condition-item pending" id="cond-4">
                                <div class="condition-check">âœ“</div>
                                <span>Confirm gig worker availability at AED 100/unit</span>
                            </div>
                        </div>
                    </div>
                    <div class="decision-funding">
                        <div class="funding-label">Funding Required</div>
                        <div class="funding-sublabel" style="font-size: 10px; color: var(--gray-400); margin-bottom: 4px;">(Peak deficit + 20% buffer)</div>
                        <div class="funding-amount" id="decision-funding">AED 85K</div>
                        <div class="funding-details">
                            <div class="funding-detail">
                                <span class="funding-detail-icon">ðŸ“…</span>
                                <span id="funding-runway">Covers ~6 months fixed costs</span>
                            </div>
                            <div class="funding-detail">
                                <span class="funding-detail-icon">âš ï¸</span>
                                <span id="funding-risk">Key risk: Pricing validation</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BREAKEVEN HERO -->
            <div class="breakeven-hero">
                <div class="breakeven-card units">
                    <div class="breakeven-header">
                        <div class="breakeven-icon">ðŸŽ¯</div>
                        <div class="breakeven-tag">Critical Number</div>
                    </div>
                    <div class="breakeven-content">
                        <div class="breakeven-label">Properties to Cover Fixed Costs</div>
                        <div class="breakeven-value">
                            <span id="be-units">94</span>
                            <span class="breakeven-suffix">properties</span>
                        </div>
                        <div class="breakeven-detail" id="be-units-detail">
                            At 94 properties, monthly revenue covers all fixed costs
                        </div>
                    </div>
                    <div class="breakeven-formula">
                        <span class="formula-label">Formula:</span>
                        <span class="formula-code" id="be-formula">22,000 Ã· (350 - 115) = 94</span>
                    </div>
                    <div class="breakeven-progress">
                        <div class="breakeven-progress-fill" id="be-units-progress" style="width: 0%;"></div>
                    </div>
                </div>
                
                <div class="breakeven-card time">
                    <div class="breakeven-header">
                        <div class="breakeven-icon">â±ï¸</div>
                        <div class="breakeven-tag">Timeline</div>
                    </div>
                    <div class="breakeven-content">
                        <div class="breakeven-label">Months to Profitability</div>
                        <div class="breakeven-value">
                            <span id="be-month-value">10</span>
                            <span class="breakeven-suffix">months</span>
                        </div>
                        <div class="breakeven-detail" id="be-month-detail">
                            Cumulative cash turns positive in Month 10
                        </div>
                    </div>
                    <div class="breakeven-formula">
                        <span class="formula-label">Monthly Burn:</span>
                        <span class="formula-code" id="burn-rate">AED 22K/mo â†’ AED 8K surplus @ M10</span>
                    </div>
                    <div class="breakeven-progress">
                        <div class="breakeven-progress-fill" id="be-month-progress" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <!-- SENSITIVITY ANALYSIS -->
            <div class="sensitivity-section">
                <div class="sensitivity-header">
                    <div class="sensitivity-header-left">
                        <h3>ðŸŽšï¸ Sensitivity Analysis</h3>
                        <p>What variables have the biggest impact on profitability?</p>
                    </div>
                    <div class="sensitivity-legend">
                        <div class="legend-item">
                            <div class="legend-dot negative"></div>
                            <span>-20% Change</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot base"></div>
                            <span>Base</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot positive"></div>
                            <span>+20% Change</span>
                        </div>
                    </div>
                </div>
                
                <div class="sensitivity-grid" id="sensitivity-grid">
                    <!-- Rows populated by JS -->
                </div>
                
                <div class="sensitivity-insight" id="sensitivity-insight">
                    <div class="insight-icon">âš¡</div>
                    <div class="insight-content">
                        <h4>Highest Risk: Price Sensitivity</h4>
                        <p>A <strong>20% drop in price</strong> would significantly reduce Y1 EBITDA. Validating willingness-to-pay is the #1 priority before scaling.</p>
                    </div>
                </div>
            </div>

            <!-- Executive Summary -->
            <div class="executive-summary" id="exec-summary">
                <div class="summary-main">
                    <div class="summary-eyebrow">ðŸ“Š <span id="scenario-name">Base Case</span> Summary</div>
                    <p class="summary-insight" id="exec-insight">
                        At <strong>AED <span id="exec-price">350</span>/property</strong>, base case projects <strong><span id="exec-units">220</span> properties</strong> in Y1, 
                        <strong>break-even by <span id="exec-be-text">Month 10</span></strong>, 
                        Y1 EBITDA of <strong><span id="exec-ebitda-text">AED 42K</span></strong>, 
                        requiring <strong><span id="exec-funding-text">AED 85K</span></strong> to de-risk.
                    </p>
                </div>
                <div class="summary-kpis">
                    <div class="summary-kpi">
                        <div class="summary-kpi-value" id="sum-be">Month 10</div>
                        <div class="summary-kpi-label">Break-Even</div>
                    </div>
                    <div class="summary-kpi">
                        <div class="summary-kpi-value" id="sum-ebitda">AED 42K</div>
                        <div class="summary-kpi-label">Y1 EBITDA</div>
                    </div>
                    <div class="summary-kpi">
                        <div class="summary-kpi-value" id="sum-units">220</div>
                        <div class="summary-kpi-label">Y1 Properties</div>
                    </div>
                    <div class="summary-kpi">
                        <div class="summary-kpi-value" id="sum-funding">AED 85K</div>
                        <div class="summary-kpi-label">Funding Need</div>
                    </div>
                </div>
            </div>

            <!-- Comparison vs Original BP -->
            <div class="comparison-strip">
                <div class="comparison-card original">
                    <div class="comparison-label">Original Business Plan</div>
                    <div class="comparison-metrics">
                        <div class="comparison-metric">
                            <div class="comparison-metric-value">587</div>
                            <div class="comparison-metric-label">Y1 Properties</div>
                        </div>
                        <div class="comparison-metric">
                            <div class="comparison-metric-value">AED 824K</div>
                            <div class="comparison-metric-label">Y1 Revenue</div>
                        </div>
                        <div class="comparison-metric">
                            <div class="comparison-metric-value">M4</div>
                            <div class="comparison-metric-label">Break-even</div>
                        </div>
                    </div>
                    <div class="comparison-delta down">Optimistic</div>
                </div>
                <div class="comparison-card validated">
                    <div class="comparison-label">Current Model</div>
                    <div class="comparison-metrics">
                        <div class="comparison-metric">
                            <div class="comparison-metric-value" id="comp-units">220</div>
                            <div class="comparison-metric-label">Y1 Properties</div>
                        </div>
                        <div class="comparison-metric">
                            <div class="comparison-metric-value" id="comp-revenue">AED 350K</div>
                            <div class="comparison-metric-label">Y1 Revenue</div>
                        </div>
                        <div class="comparison-metric">
                            <div class="comparison-metric-value" id="comp-be">M10</div>
                            <div class="comparison-metric-label">Break-even</div>
                        </div>
                    </div>
                    <div class="comparison-delta realistic">Realistic</div>
                </div>
            </div>

            <!-- Key Ratios -->
            <div class="ratios-grid">
                <div class="ratio-card warning" id="ratio-ltv">
                    <div class="ratio-header">
                        <span class="ratio-label">LTV / CAC</span>
                        <span class="ratio-status"></span>
                    </div>
                    <div class="ratio-value" id="ratio-ltv-value">2.8x</div>
                    <div class="ratio-target">Per property, target > 3x</div>
                    <div class="ratio-bar"><div class="ratio-bar-fill" style="width: 70%"></div></div>
                </div>
                <div class="ratio-card warning" id="ratio-payback">
                    <div class="ratio-header">
                        <span class="ratio-label">Payback Period</span>
                        <span class="ratio-status"></span>
                    </div>
                    <div class="ratio-value" id="ratio-payback-value">5.2 mo</div>
                    <div class="ratio-target">Target: < 12 mo</div>
                    <div class="ratio-bar"><div class="ratio-bar-fill" style="width: 60%"></div></div>
                </div>
                <div class="ratio-card success" id="ratio-gm">
                    <div class="ratio-header">
                        <span class="ratio-label">Gross Margin</span>
                        <span class="ratio-status"></span>
                    </div>
                    <div class="ratio-value" id="ratio-gm-value">62%</div>
                    <div class="ratio-target">Target: > 60%</div>
                    <div class="ratio-bar"><div class="ratio-bar-fill" style="width: 100%"></div></div>
                </div>
                <div class="ratio-card warning" id="ratio-ebitda-margin">
                    <div class="ratio-header">
                        <span class="ratio-label">EBITDA Margin</span>
                        <span class="ratio-status"></span>
                    </div>
                    <div class="ratio-value" id="ratio-ebitda-margin-value">-12%</div>
                    <div class="ratio-target">Target: > 10%</div>
                    <div class="ratio-bar"><div class="ratio-bar-fill" style="width: 87%"></div></div>
                </div>
            </div>

            <!-- Validation Gaps -->
            <div class="validation-gaps">
                <div class="validation-gaps-header">
                    <div>
                        <div class="validation-gaps-title">ðŸ”¬ Validation Status</div>
                        <div class="validation-gaps-subtitle">What's proven vs. what still needs customer validation</div>
                    </div>
                </div>
                <div class="gap-grid">
                    <div class="gap-item validated">
                        <div class="gap-label">Market Size</div>
                        <div class="gap-status">âœ“ 21,000 licensed STR units confirmed</div>
                    </div>
                    <div class="gap-item validated">
                        <div class="gap-label">Operator Landscape</div>
                        <div class="gap-status">âœ“ Top 10 operators mapped</div>
                    </div>
                    <div class="gap-item critical">
                        <div class="gap-label">Willingness to Pay</div>
                        <div class="gap-status">âš  Needs pilot validation</div>
                    </div>
                    <div class="gap-item">
                        <div class="gap-label">Conversion Rate</div>
                        <div class="gap-status">â†’ Assumed 50%. To be validated in pilots</div>
                    </div>
                </div>
            </div>

            <!-- Milestones -->
            <div class="milestones-card">
                <div class="milestones-header">
                    <div>
                        <div class="milestones-title">ðŸŽ¯ Go/No-Go Milestones</div>
                        <div class="milestones-subtitle">Targets with kill criteria</div>
                    </div>
                </div>
                <div class="milestone-track">
                    <div class="milestone on-track" id="milestone-1">
                        <div class="milestone-node">D90</div>
                        <div class="milestone-content">
                            <div class="milestone-label">Day 90</div>
                            <div class="milestone-projected">Projected: <strong id="ms1-target">35</strong></div>
                            <div class="milestone-vs">Target: <span id="ms1-base">35</span></div>
                            <div class="milestone-kill">Kill: <strong id="ms1-kill">&lt; 15</strong></div>
                        </div>
                    </div>
                    <div class="milestone on-track" id="milestone-2">
                        <div class="milestone-node">M6</div>
                        <div class="milestone-content">
                            <div class="milestone-label">Month 6</div>
                            <div class="milestone-projected">Projected: <strong id="ms2-target">90</strong></div>
                            <div class="milestone-vs">Target: <span id="ms2-base">90</span></div>
                            <div class="milestone-kill">Kill: <strong id="ms2-kill">&lt; 45</strong></div>
                        </div>
                    </div>
                    <div class="milestone on-track" id="milestone-3">
                        <div class="milestone-node">M9</div>
                        <div class="milestone-content">
                            <div class="milestone-label">Month 9</div>
                            <div class="milestone-projected">Projected: <strong id="ms3-target">150</strong></div>
                            <div class="milestone-vs">Target: <span id="ms3-base">150</span></div>
                            <div class="milestone-kill">Kill: <strong id="ms3-kill">&lt; 75</strong></div>
                        </div>
                    </div>
                    <div class="milestone on-track" id="milestone-4">
                        <div class="milestone-node">M12</div>
                        <div class="milestone-content">
                            <div class="milestone-label">Month 12</div>
                            <div class="milestone-projected">Projected: <strong id="ms4-target">220</strong></div>
                            <div class="milestone-vs">Target: <span id="ms4-base">220</span></div>
                            <div class="milestone-kill">Kill: <strong id="ms4-kill">&lt; 100</strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Monthly EBITDA</div>
                        <div class="chart-subtitle">Path to profitability</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="ebitdaChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Cumulative Cash Flow</div>
                        <div class="chart-subtitle">Funding requirement visualization</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="cashChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Unit Economics & Cash -->
            <div class="data-grid">
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">Unit Economics</div>
                        <div class="data-card-subtitle" id="ue-subtitle">Per property, per month at AED 350</div>
                    </div>
                    <div class="data-rows">
                        <div class="data-row">
                            <span class="data-row-label">Revenue per Property</span>
                            <span class="data-row-value" id="ue-revenue">AED 350</span>
                        </div>
                        <div class="data-row negative">
                            <span class="data-row-label">Inspector Cost</span>
                            <span class="data-row-value" id="ue-labor">â€“ AED 115</span>
                        </div>
                        <div class="data-row">
                            <span class="data-row-label">Gross Profit</span>
                            <span class="data-row-value" id="ue-gp">AED 235</span>
                        </div>
                        <div class="data-row negative">
                            <span class="data-row-label">Allocated Fixed Costs</span>
                            <span class="data-row-value" id="ue-fixed">â€“ AED 92</span>
                        </div>
                        <div class="data-row total">
                            <span class="data-row-label">Net Contribution</span>
                            <span class="data-row-value" id="ue-cm">AED 143</span>
                        </div>
                    </div>
                </div>
                <div class="data-card">
                    <div class="data-card-header">
                        <div class="data-card-title">Funding Requirements</div>
                        <div class="data-card-subtitle">Peak deficit + 20% safety buffer</div>
                    </div>
                    <div class="data-rows">
                        <div class="data-row">
                            <span class="data-row-label">Peak Cash Deficit</span>
                            <span class="data-row-value" id="cash-deficit">AED 72K</span>
                        </div>
                        <div class="data-row">
                            <span class="data-row-label">Safety Buffer (20%)</span>
                            <span class="data-row-value" id="cash-buffer">AED 15K</span>
                        </div>
                        <div class="data-row">
                            <span class="data-row-label">Raise Target</span>
                            <span class="data-row-value" id="cash-raise">AED 100K</span>
                        </div>
                        <div class="data-row">
                            <span class="data-row-label">EBITDA Break-even</span>
                            <span class="data-row-value" id="cash-be">Month 10</span>
                        </div>
                        <div class="data-row total">
                            <span class="data-row-label">Y1 End Cash Position</span>
                            <span class="data-row-value" id="cash-end">AED 42K</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly P&L -->
            <div class="pnl-section">
                <div class="pnl-header">
                    <div>
                        <div class="pnl-title">ðŸ“‹ Monthly P&L</div>
                        <div class="pnl-subtitle">Conservative projections based on market research</div>
                    </div>
                    <button class="export-btn" onclick="exportCSV()">
                        <span>ðŸ“¥</span> Export CSV
                    </button>
                </div>
                <div class="pnl-table-wrap">
                    <table class="pnl-table" id="pnl-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>M1</th><th>M2</th><th>M3</th><th>M4</th><th>M5</th><th>M6</th>
                                <th>M7</th><th>M8</th><th>M9</th><th>M10</th><th>M11</th><th>M12</th>
                                <th>Y1 Total</th>
                            </tr>
                        </thead>
                        <tbody id="pnl-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- 3-Year Projection -->
            <div class="projection-section">
                <div class="projection-header">
                    <div>
                        <div class="projection-title">ðŸ“ˆ 3-Year Growth Trajectory</div>
                        <div class="projection-subtitle">From startup to scale</div>
                    </div>
                    <div class="projection-toggle">
                        <button class="proj-view-btn active" data-view="summary">Summary</button>
                        <button class="proj-view-btn" data-view="detailed">Detailed</button>
                    </div>
                </div>
                
                <!-- Summary View -->
                <div class="projection-content" id="proj-summary">
                    <div class="year-cards">
                        <div class="year-card year-1">
                            <div class="year-badge">Year 1</div>
                            <div class="year-phase">Launch & Validate</div>
                            <div class="year-metrics">
                                <div class="year-metric primary">
                                    <span class="year-metric-value" id="y1-revenue">AED 350K</span>
                                    <span class="year-metric-label">Revenue</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y1-ebitda">AED 42K</span>
                                    <span class="year-metric-label">EBITDA</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y1-units">220</span>
                                    <span class="year-metric-label">Properties</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y1-operators">10</span>
                                    <span class="year-metric-label">Managers</span>
                                </div>
                            </div>
                            <div class="year-bar"><div class="year-bar-fill" id="y1-bar"></div></div>
                        </div>
                        
                        <div class="year-card year-2">
                            <div class="year-badge">Year 2</div>
                            <div class="year-phase">Scale & Optimize</div>
                            <div class="year-metrics">
                                <div class="year-metric primary">
                                    <span class="year-metric-value" id="y2-revenue">AED 1.2M</span>
                                    <span class="year-metric-label">Revenue</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y2-ebitda">AED 380K</span>
                                    <span class="year-metric-label">EBITDA</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y2-units">600</span>
                                    <span class="year-metric-label">Properties</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y2-operators">25</span>
                                    <span class="year-metric-label">Managers</span>
                                </div>
                            </div>
                            <div class="year-bar"><div class="year-bar-fill" id="y2-bar"></div></div>
                        </div>
                        
                        <div class="year-card year-3">
                            <div class="year-badge">Year 3</div>
                            <div class="year-phase">Market Leadership</div>
                            <div class="year-metrics">
                                <div class="year-metric primary">
                                    <span class="year-metric-value" id="y3-revenue">AED 2.8M</span>
                                    <span class="year-metric-label">Revenue</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y3-ebitda">AED 920K</span>
                                    <span class="year-metric-label">EBITDA</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y3-units">1,200</span>
                                    <span class="year-metric-label">Properties</span>
                                </div>
                                <div class="year-metric">
                                    <span class="year-metric-value" id="y3-operators">50</span>
                                    <span class="year-metric-label">Managers</span>
                                </div>
                            </div>
                            <div class="year-bar"><div class="year-bar-fill" id="y3-bar"></div></div>
                        </div>
                    </div>
                    
                    <!-- Growth Chart -->
                    <div class="projection-chart-container">
                        <canvas id="projectionChart"></canvas>
                    </div>
                    
                    <!-- Valuation Indicator -->
                    <div class="valuation-strip">
                        <div class="valuation-item">
                            <span class="valuation-label">Y3 ARR</span>
                            <span class="valuation-value" id="val-arr">AED 3.6M</span>
                        </div>
                        <div class="valuation-divider">Ã—</div>
                        <div class="valuation-item">
                            <span class="valuation-label">Multiple</span>
                            <span class="valuation-value">4x</span>
                        </div>
                        <div class="valuation-divider">=</div>
                        <div class="valuation-item highlight">
                            <span class="valuation-label">Implied Valuation</span>
                            <span class="valuation-value" id="val-total">AED 14.4M</span>
                        </div>
                    </div>
                    <div style="text-align: center; font-size: 11px; color: var(--gray-400); margin-top: 8px;">
                        4x ARR multiple typical for early-stage B2B SaaS in emerging markets
                    </div>
                </div>
                
                <!-- Detailed View -->
                <div class="projection-content hidden" id="proj-detailed">
                    <div class="projection-assumptions">
                        <div class="assumption-group">
                            <h5>ðŸ“ˆ Growth Assumptions</h5>
                            <div class="assumption-row">
                                <label>Y2 Monthly Growth</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-y2-growth" min="5" max="25" value="10">
                                    <span class="assumption-value" id="val-y2-growth">10%</span>
                                </div>
                            </div>
                            <div class="assumption-row">
                                <label>Y3 Monthly Growth</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-y3-growth" min="3" max="15" value="6">
                                    <span class="assumption-value" id="val-y3-growth">6%</span>
                                </div>
                            </div>
                            <div class="assumption-row">
                                <label>Churn Improvement / Year</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-churn-improve" min="0" max="40" value="15">
                                    <span class="assumption-value" id="val-churn-improve">15%</span>
                                </div>
                            </div>
                        </div>
                        <div class="assumption-group">
                            <h5>ðŸ‘¥ Team Scaling</h5>
                            <div class="assumption-row">
                                <label>Y2 New Hires</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-y2-hires" min="0" max="5" value="1">
                                    <span class="assumption-value" id="val-y2-hires">1</span>
                                </div>
                            </div>
                            <div class="assumption-row">
                                <label>Y3 New Hires</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-y3-hires" min="0" max="8" value="2">
                                    <span class="assumption-value" id="val-y3-hires">2</span>
                                </div>
                            </div>
                            <div class="assumption-row">
                                <label>Avg Salary / Hire</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-avg-salary" min="5000" max="15000" step="500" value="8000">
                                    <span class="assumption-value" id="val-avg-salary">AED 8K</span>
                                </div>
                            </div>
                        </div>
                        <div class="assumption-group">
                            <h5>ðŸ¢ Cost Scaling</h5>
                            <div class="assumption-row">
                                <label>Fixed Cost Growth / Year</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-fixed-growth" min="10" max="60" value="25">
                                    <span class="assumption-value" id="val-fixed-growth">25%</span>
                                </div>
                            </div>
                            <div class="assumption-row">
                                <label>Marketing Scale-up / Year</label>
                                <div class="assumption-control">
                                    <input type="range" id="slider-marketing-growth" min="0" max="100" value="30">
                                    <span class="assumption-value" id="val-marketing-growth">30%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detailed Table -->
                    <div class="projection-table-wrap">
                        <table class="projection-table" id="projection-table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Year 1</th>
                                    <th>Year 2</th>
                                    <th>Year 3</th>
                                    <th>3-Year Total</th>
                                </tr>
                            </thead>
                            <tbody id="projection-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Monte Carlo Simulation -->
            <div class="monte-carlo-section" id="monte-carlo">
                <div class="monte-carlo-header">
                    <div>
                        <div class="monte-carlo-title">ðŸŽ² Monte Carlo Simulation</div>
                        <div class="monte-carlo-subtitle">Internal risk radar â€” 10,000 iterations with randomized assumptions</div>
                    </div>
                    <button class="mc-run-btn" id="mc-run-btn" onclick="runMonteCarloSimulation()" style="background: linear-gradient(135deg, #1a365d, #2c5282); color: #fff;">
                        <span style="color: #fff;">â–¶</span> <span style="color: #fff;">Run Simulation</span>
                    </button>
                </div>
                
                <div class="mc-disclaimer">
                    <span class="mc-disclaimer-icon">âš ï¸</span>
                    <div class="mc-disclaimer-text">
                        <strong>For internal risk comparison only.</strong> These probabilities reflect assumed uncertainty ranges based on market research, not validated pilot data. 
                        Use to compare scenarios and identify risks â€” not as externally "scientific" claims. Validate through customer pilots.
                    </div>
                </div>
                
                <div id="mc-loading" class="mc-loading" style="display: none;">
                    <div class="mc-spinner"></div>
                    <span>Running 10,000 simulations...</span>
                </div>
                
                <div id="mc-results" style="display: none;">
                    
                    <!-- Decision Rules Section -->
                    <div class="mc-section-label">ðŸ“‹ Decision Rules</div>
                    <div class="mc-decision-grid">
                        <div class="mc-decision-card" id="mc-decision-funding">
                            <div class="mc-decision-title">ðŸ’° Funding for 80% Confidence</div>
                            <div class="mc-decision-value" id="mc-funding-80">â€”</div>
                            <div class="mc-decision-detail" id="mc-funding-80-detail">Amount needed to survive Y1 in 80% of scenarios</div>
                            <div class="mc-decision-action" id="mc-funding-80-action">â†’ Current ask: AED 85K</div>
                        </div>
                        <div class="mc-decision-card danger" id="mc-decision-kill">
                            <div class="mc-decision-title">ðŸŽ¯ Kill Zone Risk (M12 &lt; 100 properties)</div>
                            <div class="mc-decision-value" id="mc-kill-prob">â€”</div>
                            <div class="mc-decision-detail">Probability of hitting M12 kill threshold</div>
                            <div class="mc-decision-action" id="mc-kill-action">â†’ Target: &lt; 20% probability</div>
                        </div>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div class="mc-section-label">ðŸ“Š Outcome Distribution</div>
                    <div class="mc-results-grid">
                        <div class="mc-result-card highlight">
                            <div class="mc-result-label">Probability of Profit (Y1)</div>
                            <div class="mc-result-value" id="mc-prob-profit">â€”</div>
                            <div class="mc-result-detail">EBITDA > 0</div>
                        </div>
                        <div class="mc-result-card">
                            <div class="mc-result-label">Expected Y1 EBITDA</div>
                            <div class="mc-result-value" id="mc-expected-ebitda">â€”</div>
                            <div class="mc-result-detail" id="mc-ebitda-range">P10-P90 range</div>
                        </div>
                        <div class="mc-result-card">
                            <div class="mc-result-label">Expected Break-even</div>
                            <div class="mc-result-value" id="mc-expected-be">â€”</div>
                            <div class="mc-result-detail" id="mc-be-prob">% achieve in Y1</div>
                        </div>
                        <div class="mc-result-card highlight">
                            <div class="mc-result-label">Funding Sufficient</div>
                            <div class="mc-result-value" id="mc-funding-conf">â€”</div>
                            <div class="mc-result-detail">AED 85K covers Y1</div>
                        </div>
                    </div>
                    
                    <!-- Distribution Charts -->
                    <div class="mc-charts-grid">
                        <div class="mc-chart-container">
                            <div class="mc-chart-title">Y1 EBITDA Distribution</div>
                            <div class="mc-histogram" id="mc-ebitda-histogram"></div>
                            <div class="mc-axis">
                                <span id="mc-ebitda-min">-200K</span>
                                <span>0</span>
                                <span id="mc-ebitda-max">400K</span>
                            </div>
                            <div class="mc-percentiles">
                                <div class="mc-percentile">
                                    <div class="mc-percentile-label">P10 (Downside)</div>
                                    <div class="mc-percentile-value" id="mc-ebitda-p10">â€”</div>
                                </div>
                                <div class="mc-percentile">
                                    <div class="mc-percentile-label">P50 (Median)</div>
                                    <div class="mc-percentile-value" id="mc-ebitda-p50">â€”</div>
                                </div>
                                <div class="mc-percentile">
                                    <div class="mc-percentile-label">P90 (Upside)</div>
                                    <div class="mc-percentile-value" id="mc-ebitda-p90">â€”</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mc-chart-container">
                            <div class="mc-chart-title">Milestone Achievement</div>
                            <div class="mc-probability-bars">
                                <div class="mc-prob-row">
                                    <span class="mc-prob-label">Break-even in Y1</span>
                                    <div class="mc-prob-bar-bg">
                                        <div class="mc-prob-bar-fill" id="mc-prob-be-bar" style="width: 0%"></div>
                                    </div>
                                    <span class="mc-prob-value" id="mc-prob-be-val">â€”</span>
                                </div>
                                <div class="mc-prob-row">
                                    <span class="mc-prob-label">200+ properties (Y1)</span>
                                    <div class="mc-prob-bar-bg">
                                        <div class="mc-prob-bar-fill" id="mc-prob-units-bar" style="width: 0%"></div>
                                    </div>
                                    <span class="mc-prob-value" id="mc-prob-units-val">â€”</span>
                                </div>
                                <div class="mc-prob-row">
                                    <span class="mc-prob-label">Funding sufficient</span>
                                    <div class="mc-prob-bar-bg">
                                        <div class="mc-prob-bar-fill" id="mc-prob-fund-bar" style="width: 0%"></div>
                                    </div>
                                    <span class="mc-prob-value" id="mc-prob-fund-val">â€”</span>
                                </div>
                                <div class="mc-prob-row">
                                    <span class="mc-prob-label">Y1 Revenue > 500K</span>
                                    <div class="mc-prob-bar-bg">
                                        <div class="mc-prob-bar-fill" id="mc-prob-rev-bar" style="width: 0%"></div>
                                    </div>
                                    <span class="mc-prob-value" id="mc-prob-rev-val">â€”</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stress Tests -->
                    <div class="mc-stress-section">
                        <div class="mc-section-label">ðŸ”¥ Stress Tests â€” "What If We're Wrong?"</div>
                        <div class="mc-stress-grid">
                            <div class="mc-stress-card">
                                <div class="mc-stress-scenario">Churn 50% worse than assumed</div>
                                <div class="mc-stress-result" id="mc-stress-churn">
                                    Running stress test...
                                </div>
                            </div>
                            <div class="mc-stress-card">
                                <div class="mc-stress-scenario">Price 20% lower (AED 280)</div>
                                <div class="mc-stress-result" id="mc-stress-price">
                                    Running stress test...
                                </div>
                            </div>
                            <div class="mc-stress-card">
                                <div class="mc-stress-scenario">Conversion 30% worse</div>
                                <div class="mc-stress-result" id="mc-stress-conversion">
                                    Running stress test...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Assumptions Transparency -->
                    <details class="mc-assumptions-used">
                        <summary>ðŸ“ Uncertainty Ranges Used in This Simulation</summary>
                        <div class="mc-assumptions-grid" id="mc-assumptions-grid">
                            <!-- Populated by JS -->
                        </div>
                    </details>
                </div>
                
                <div id="mc-placeholder" class="mc-loading">
                    <span style="color: var(--gray-400);">Click "Run Simulation" to generate probability distributions and decision rules</span>
                </div>
            </div>

            <!-- Scenario Comparison -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">Scenario Comparison</div>
                    <div class="section-subtitle">Bear vs Base vs Bull with realistic assumptions</div>
                </div>
                <div class="table-card">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th class="bear-col">ðŸ» Bear</th>
                                <th class="base-col">ðŸ“Š Base</th>
                                <th class="bull-col">ðŸ‚ Bull</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Price/Property</td>
                                <td class="bear-col"><span class="value" id="sc-bear-price">AED 199</span></td>
                                <td class="base-col"><span class="value" id="sc-base-price">AED 350</span></td>
                                <td class="bull-col"><span class="value" id="sc-bull-price">AED 399</span></td>
                            </tr>
                            <tr>
                                <td>M12 Properties</td>
                                <td class="bear-col"><span class="value" id="sc-bear-units">75</span></td>
                                <td class="base-col"><span class="value" id="sc-base-units">220</span></td>
                                <td class="bull-col"><span class="value" id="sc-bull-units">630</span></td>
                            </tr>
                            <tr>
                                <td>Y1 Revenue</td>
                                <td class="bear-col"><span class="value" id="sc-bear-rev">AED 89K</span></td>
                                <td class="base-col"><span class="value" id="sc-base-rev">AED 350K</span></td>
                                <td class="bull-col"><span class="value" id="sc-bull-rev">AED 1.2M</span></td>
                            </tr>
                            <tr>
                                <td>Y1 EBITDA</td>
                                <td class="bear-col"><span class="value negative" id="sc-bear-ebitda">-AED 180K</span></td>
                                <td class="base-col"><span class="value positive" id="sc-base-ebitda">AED 42K</span></td>
                                <td class="bull-col"><span class="value positive" id="sc-bull-ebitda">AED 380K</span></td>
                            </tr>
                            <tr>
                                <td>Break-Even</td>
                                <td class="bear-col"><span class="value" id="sc-bear-be">Never (Y1)</span></td>
                                <td class="base-col"><span class="value" id="sc-base-be">Month 10</span></td>
                                <td class="bull-col"><span class="value" id="sc-bull-be">Month 5</span></td>
                            </tr>
                            <tr>
                                <td>Funding Need</td>
                                <td class="bear-col"><span class="value negative" id="sc-bear-cash">AED 200K</span></td>
                                <td class="base-col"><span class="value" id="sc-base-cash">AED 85K</span></td>
                                <td class="bull-col"><span class="value" id="sc-bull-cash">AED 40K</span></td>
                            </tr>
                            <tr>
                                <td>Verdict</td>
                                <td class="bear-col"><span class="verdict-tag danger" id="sc-bear-verdict">Revisit Pricing</span></td>
                                <td class="base-col"><span class="verdict-tag warning" id="sc-base-verdict">Conditional</span></td>
                                <td class="bull-col"><span class="verdict-tag success" id="sc-bull-verdict">Strong Go</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">âš™ï¸ Model Inputs</div>
            </div>

            <div class="sidebar-section">
                <h4>ðŸ“Š Scenario</h4>
                <div class="scenario-toggle">
                    <button class="scenario-btn" data-scenario="bear">
                        <span class="scenario-icon">ðŸ»</span>
                        <span class="scenario-label">Bear</span>
                    </button>
                    <button class="scenario-btn active" data-scenario="base">
                        <span class="scenario-icon">ðŸ“Š</span>
                        <span class="scenario-label">Base</span>
                    </button>
                    <button class="scenario-btn" data-scenario="bull">
                        <span class="scenario-icon">ðŸ‚</span>
                        <span class="scenario-label">Bull</span>
                    </button>
                </div>
                <div class="scenario-description" id="scenario-description">
                    Base projection: 50% pilot conversion, 22 properties per manager avg.
                </div>
            </div>

            <div class="sidebar-section">
                <h4>ðŸ’° Price per Property</h4>
                <div class="price-grid">
                    <button class="price-btn recommended active" data-price="350"><span class="num">350</span><span class="label">Base</span></button>
                    <button class="price-btn" data-price="299"><span class="num">299</span><span class="label">Test</span></button>
                    <button class="price-btn" data-price="399"><span class="num">399</span><span class="label">Premium</span></button>
                    <button class="price-btn" data-price="199"><span class="num">199</span><span class="label">Floor</span></button>
                </div>
            </div>

            <div class="sidebar-section">
                <h4>ðŸ“ˆ Growth Assumptions</h4>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Pilots/Month (After M3)</label>
                        <span class="slider-value validated" id="val-pilots">5</span>
                    </div>
                    <input type="range" id="slider-pilots" min="2" max="10" step="1" value="5">
                    <div class="slider-hint research">Benchmark: 3-8 realistic capacity</div>
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Pilot Conversion Rate</label>
                        <span class="slider-value validated" id="val-conversion">50%</span>
                    </div>
                    <input type="range" id="slider-conversion" min="25" max="70" step="5" value="50">
                    <div class="slider-hint research">Typical range: 35-65% in similar markets</div>
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Avg Properties per Manager</label>
                        <span class="slider-value validated" id="val-avg-units">22</span>
                    </div>
                    <input type="range" id="slider-avg-units" min="10" max="40" step="2" value="22">
                    <div class="slider-hint research">Typical range: 15-35 properties</div>
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Monthly Churn</label>
                        <span class="slider-value validated" id="val-churn">8%</span>
                    </div>
                    <input type="range" id="slider-churn" min="3" max="15" step="1" value="8">
                    <div class="slider-hint research">Typical range: 6-15% for new services</div>
                </div>
                <div class="growth-summary">
                    <div class="growth-summary-row">
                        <div class="growth-summary-item">
                            <div class="growth-summary-label">Managers Y1</div>
                            <div class="growth-summary-value" id="projected-operators">10</div>
                        </div>
                        <div class="growth-summary-item">
                            <div class="growth-summary-label">Avg Properties</div>
                            <div class="growth-summary-value" id="projected-avg">22</div>
                        </div>
                    </div>
                    <div class="growth-summary-total">
                        <div class="growth-summary-label">M12 Properties</div>
                        <div class="growth-summary-value" id="projected-m12">220</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h4>ðŸ’¼ Inspector Costs</h4>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Payout / Inspection</label>
                        <span class="slider-value" id="val-gig-payout">AED 100</span>
                    </div>
                    <input type="range" id="slider-gig-payout" min="60" max="150" step="5" value="100">
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Platform Fee</label>
                        <span class="slider-value" id="val-platform-fee">AED 15</span>
                    </div>
                    <input type="range" id="slider-platform-fee" min="5" max="30" step="1" value="15">
                </div>
            </div>

            <div class="sidebar-section">
                <h4>ðŸ¢ Monthly Fixed Costs</h4>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Founder Salary</label>
                        <span class="slider-value" id="val-founder">AED 12,000</span>
                    </div>
                    <input type="range" id="slider-founder" min="0" max="25000" step="1000" value="12000">
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Team Salaries</label>
                        <span class="slider-value" id="val-team">AED 0</span>
                    </div>
                    <input type="range" id="slider-team" min="0" max="40000" step="1000" value="0">
                    <div class="slider-hint">Ops, sales, admin (excl. inspectors)</div>
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Marketing</label>
                        <span class="slider-value" id="val-marketing">AED 3,000</span>
                    </div>
                    <input type="range" id="slider-marketing" min="0" max="15000" step="500" value="3000">
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Tech / Infra</label>
                        <span class="slider-value" id="val-tech">AED 4,000</span>
                    </div>
                    <input type="range" id="slider-tech" min="1000" max="10000" step="500" value="4000">
                </div>
                <div class="slider-group">
                    <div class="slider-header">
                        <label>Office & Admin</label>
                        <span class="slider-value" id="val-office">AED 3,000</span>
                    </div>
                    <input type="range" id="slider-office" min="0" max="10000" step="500" value="3000">
                </div>
            </div>
        </aside>
    </div>

    <footer class="footer"><span>LUCAS</span> Financial Model Â· December 2025</footer>
    <button class="mobile-toggle" id="mobile-toggle">âš™ï¸</button>

    <script>
        // ===== TARGET THRESHOLDS (centralized for maintainability) =====
        const TARGETS = {
            ltvCacMin: 3,           // LTV/CAC >= 3x is good
            ltvCacOk: 2,            // LTV/CAC >= 2x is acceptable
            paybackMax: 12,         // Payback <= 12 months is good
            paybackOk: 18,          // Payback <= 18 months is acceptable
            grossMarginGood: 0.6,   // Gross margin >= 60% is good
            grossMarginOk: 0.4,     // Gross margin >= 40% is acceptable
            ebitdaMarginGood: 10,   // EBITDA margin >= 10% is good
            ebitdaMarginOk: 0       // EBITDA margin >= 0% is acceptable
        };

        // Research-validated scenarios
        const scenarios = {
            bear: {
                name: 'ðŸ» Bear Case',
                description: 'Conservative: Discount pricing at AED 199, slow conversion, high churn.',
                assumptions: {
                    price: 199,
                    pilotsPerMonth: 3,
                    conversionRate: 35,
                    avgUnitsPerOperator: 15,
                    churnRate: 12,
                    gigPayout: 120,
                    platformFee: 18,
                    founderSalary: 15000,
                    teamSalaries: 5000,
                    marketing: 5000,
                    tech: 5000,
                    office: 4000
                }
            },
            base: {
                name: 'ðŸ“Š Base Case',
                description: 'Base projection: 50% pilot conversion, 22 properties per manager avg.',
                assumptions: {
                    price: 350,
                    pilotsPerMonth: 5,
                    conversionRate: 50,
                    avgUnitsPerOperator: 22,
                    churnRate: 8,
                    gigPayout: 100,
                    platformFee: 15,
                    founderSalary: 12000,
                    teamSalaries: 0,
                    marketing: 3000,
                    tech: 4000,
                    office: 3000
                }
            },
            bull: {
                name: 'ðŸ‚ Bull Case',
                description: 'Optimistic: Premium pricing accepted, strong word-of-mouth.',
                assumptions: {
                    price: 399,
                    pilotsPerMonth: 8,
                    conversionRate: 65,
                    avgUnitsPerOperator: 35,
                    churnRate: 5,
                    gigPayout: 90,
                    platformFee: 12,
                    founderSalary: 10000,
                    teamSalaries: 0,
                    marketing: 2000,
                    tech: 3500,
                    office: 2500
                }
            }
        };

        let currentScenario = 'base';
        let currentPrice = 350;
        let ebitdaChart, cashChart, projectionChart;
        
        // Multi-year assumptions
        let multiYearAssumptions = {
            y2GrowthRate: 10,
            y3GrowthRate: 6,
            churnImprovement: 15,
            y2Hires: 1,
            y3Hires: 2,
            avgHireSalary: 8000,
            fixedCostGrowth: 25,
            marketingGrowth: 30
        };

        // Current assumptions (start with base case validated)
        let assumptions = { ...scenarios.base.assumptions };

        function calculateProjection() {
            const a = assumptions;
            const gigCostPerUnit = a.gigPayout + a.platformFee;
            const fixedCosts = a.founderSalary + (a.teamSalaries || 0) + a.marketing + a.tech + a.office;
            
            let months = [];
            let cumulativeOperators = 0;
            let cumulativeUnits = 0;
            let cumulativeCash = 0;
            
            for (let m = 1; m <= 12; m++) {
                // Pilots start month 3
                const pilots = m >= 3 ? a.pilotsPerMonth : 0;
                const newOperators = Math.round(pilots * (a.conversionRate / 100));
                cumulativeOperators += newOperators;
                
                // New units from new operators
                const newUnits = newOperators * a.avgUnitsPerOperator;
                
                // Churn from existing base
                const churnedUnits = Math.round(cumulativeUnits * (a.churnRate / 100));
                cumulativeUnits = cumulativeUnits + newUnits - churnedUnits;
                cumulativeUnits = Math.max(0, cumulativeUnits);
                
                // Revenue
                const revenue = cumulativeUnits * a.price;
                
                // Costs
                const laborCost = cumulativeUnits * gigCostPerUnit;
                const grossProfit = revenue - laborCost;
                const ebitda = grossProfit - fixedCosts;
                
                cumulativeCash += ebitda;
                
                months.push({
                    month: m,
                    pilots,
                    newOperators,
                    totalOperators: cumulativeOperators,
                    newUnits,
                    churnedUnits,
                    netUnits: cumulativeUnits,
                    revenue,
                    laborCost,
                    grossProfit,
                    fixedCosts,
                    ebitda,
                    cumCash: cumulativeCash
                });
            }
            
            return months;
        }

        function findBreakEven(data) {
            for (let i = 0; i < data.length; i++) {
                if (data[i].ebitda > 0) return i + 1;
            }
            return null;
        }
        
        // Unified funding calculation - use everywhere for consistency
        function computeFundingNeed(peakDeficit) {
            if (peakDeficit <= 5000) return 0;
            // Peak deficit + 20% safety buffer, rounded to nearest 1000
            return Math.ceil((peakDeficit * 1.2) / 1000) * 1000;
        }

        function fmt(n) {
            if (Math.abs(n) >= 1e6) return (n/1e6).toFixed(1) + 'M';
            return Math.round(n/1000) + 'K';
        }

        function fmtPct(n) {
            return Math.round(n * 100) + '%';
        }

        function sum(arr, key) {
            return arr.reduce((s, d) => s + d[key], 0);
        }
        
        // ===== NEW: Decision Box, Breakeven, Sensitivity =====
        
        function updateDecisionBox(data, breakEven, peakDeficit, y1EBITDA) {
            const a = assumptions;
            const fixedCosts = a.founderSalary + (a.teamSalaries || 0) + a.marketing + a.tech + a.office;
            
            // Use unified funding calculation
            const fundingNeed = computeFundingNeed(peakDeficit);
            const runway = fixedCosts > 0 ? Math.ceil((fundingNeed || fixedCosts * 3) / fixedCosts) : 12;
            
            // Determine verdict based on multiple factors
            let verdict = 'go';
            let verdictText = 'GO';
            let subtitle = 'Model is viable';
            
            const contributionMargin = a.price - (a.gigPayout + a.platformFee);
            
            if (contributionMargin <= 0) {
                // Unit economics don't work
                verdict = 'nogo';
                verdictText = 'NO GO';
                subtitle = 'Unit economics negative';
            } else if (y1EBITDA < -100000) {
                // Heavy losses
                verdict = 'nogo';
                verdictText = 'NO GO';
                subtitle = 'Significant Y1 losses';
            } else if (y1EBITDA < 0 || !breakEven) {
                // Not profitable in Y1 but could work
                verdict = 'conditional';
                verdictText = 'CONDITIONAL';
                subtitle = 'Needs more runway';
            } else if (breakEven > 9 || a.price < 250) {
                // Slow to profit or low price needs validation
                verdict = 'conditional';
                verdictText = 'CONDITIONAL';
                subtitle = 'Validate pricing first';
            }
            
            const box = document.getElementById('decision-box');
            box.className = 'decision-box ' + verdict;
            document.getElementById('verdict-status').textContent = verdictText;
            document.getElementById('verdict-subtitle').textContent = subtitle;
            
            // Funding
            document.getElementById('decision-funding').textContent = fundingNeed > 0 ? 'AED ' + fmt(fundingNeed) : 'Self-Funded';
            document.getElementById('funding-runway').textContent = `Covers ~${runway} months of fixed costs`;
            
            // Key risk based on scenario
            let keyRisk = 'Pricing validation';
            if (contributionMargin <= 0) keyRisk = 'Unit economics';
            else if (a.churnRate > 10) keyRisk = 'High churn rate';
            else if (a.conversionRate < 40) keyRisk = 'Low conversion rate';
            else if (!breakEven) keyRisk = 'Path to profitability';
            document.getElementById('funding-risk').textContent = 'Key risk: ' + keyRisk;
        }
        
        function updateBreakevenHero(data, breakEven) {
            const a = assumptions;
            const fixedCosts = a.founderSalary + (a.teamSalaries || 0) + a.marketing + a.tech + a.office;
            const variableCost = a.gigPayout + a.platformFee;
            const contributionMargin = a.price - variableCost;
            
            // Handle edge case where contribution margin is 0 or negative
            let breakevenUnits;
            if (contributionMargin <= 0) {
                breakevenUnits = 'âˆž';
                document.getElementById('be-units').textContent = 'âˆž';
                document.getElementById('be-units-detail').textContent = 'Price must exceed variable costs (AED ' + variableCost + ')';
                document.getElementById('be-formula').textContent = `Price ${a.price} â‰¤ Costs ${variableCost} = Not viable`;
                document.getElementById('be-units-progress').style.width = '0%';
            } else {
                breakevenUnits = Math.ceil(fixedCosts / contributionMargin);
                document.getElementById('be-units').textContent = breakevenUnits;
                
                // Current progress toward breakeven (at M12)
                const endUnits = data[11]?.netUnits || 0;
                
                // Dynamic text based on whether we've hit breakeven
                if (endUnits >= breakevenUnits) {
                    document.getElementById('be-units-detail').textContent = `M12 volume (${endUnits}) exceeds breakeven threshold`;
                } else {
                    document.getElementById('be-units-detail').textContent = `Breakeven at ${breakevenUnits} properties. M12 projection: ${endUnits}`;
                }
                
                document.getElementById('be-formula').textContent = `${fixedCosts.toLocaleString()} Ã· (${a.price} - ${variableCost}) = ${breakevenUnits}`;
                
                const unitsProgress = Math.min((endUnits / breakevenUnits) * 100, 100);
                document.getElementById('be-units-progress').style.width = unitsProgress + '%';
            }
            
            // Months to profitability
            const beMonth = breakEven || null;
            document.getElementById('be-month-value').textContent = beMonth || 'â€”';
            document.getElementById('be-month-detail').textContent = breakEven 
                ? `Monthly EBITDA turns positive in Month ${breakEven}`
                : 'Break-even not achieved in Year 1';
            
            const monthProgress = breakEven ? ((12 - breakEven) / 12 * 100) : 0;
            document.getElementById('be-month-progress').style.width = Math.max(0, monthProgress) + '%';
            
            // Burn rate info
            const monthlyBurn = fixedCosts;
            const m6Data = data[5];
            const m6Surplus = m6Data?.ebitda || 0;
            document.getElementById('burn-rate').textContent = `AED ${fmt(monthlyBurn)} per month burn â†’ ${m6Surplus >= 0 ? '+' : ''}AED ${fmt(m6Surplus)} @ M6`;
        }
        
        // Monte Carlo Simulation
        function runMonteCarloSimulation() {
            const btn = document.getElementById('mc-run-btn');
            const loading = document.getElementById('mc-loading');
            const results = document.getElementById('mc-results');
            const placeholder = document.getElementById('mc-placeholder');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="mc-spinner" style="width:16px;height:16px;margin-right:8px;border-color:#fff;border-top-color:#1a365d;"></span> <span style="color:#fff;">Running...</span>';
            loading.style.display = 'flex';
            results.style.display = 'none';
            placeholder.style.display = 'none';
            
            // Run simulation async to allow UI update
            setTimeout(() => {
                const simResults = executeMonteCarloSimulation(10000);
                displayMonteCarloResults(simResults);
                
                loading.style.display = 'none';
                results.style.display = 'block';
                btn.disabled = false;
                btn.innerHTML = '<span style="color:#fff;">â–¶</span> <span style="color:#fff;">Run Simulation</span>';
            }, 100);
        }
        
        function executeMonteCarloSimulation(iterations) {
            const baseAssumptions = JSON.parse(JSON.stringify(assumptions));
            const results = {
                ebitda: [],
                revenue: [],
                units: [],
                breakEven: [],
                fundingNeed: []
            };
            
            // Define uncertainty ranges (relative standard deviations)
            const uncertainty = {
                price: { mean: baseAssumptions.price, std: baseAssumptions.price * 0.15 },
                conversionRate: { mean: baseAssumptions.conversionRate, std: 12 },
                churnRate: { mean: baseAssumptions.churnRate, std: 3 },
                avgUnitsPerOperator: { mean: baseAssumptions.avgUnitsPerOperator, std: 5 },
                pilotsPerMonth: { mean: baseAssumptions.pilotsPerMonth, std: 1.5 },
                gigPayout: { mean: baseAssumptions.gigPayout, std: 15 }
            };
            
            // Box-Muller transform for normal distribution
            function randomNormal(mean, std) {
                const u1 = Math.random();
                const u2 = Math.random();
                const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                return mean + z * std;
            }
            
            // Clamp values to reasonable bounds
            function clamp(val, min, max) {
                return Math.max(min, Math.min(max, val));
            }
            
            for (let i = 0; i < iterations; i++) {
                // Sample random assumptions from distributions
                const simAssumptions = {
                    ...baseAssumptions,
                    price: clamp(randomNormal(uncertainty.price.mean, uncertainty.price.std), 150, 500),
                    conversionRate: clamp(randomNormal(uncertainty.conversionRate.mean, uncertainty.conversionRate.std), 20, 80),
                    churnRate: clamp(randomNormal(uncertainty.churnRate.mean, uncertainty.churnRate.std), 2, 20),
                    avgUnitsPerOperator: clamp(randomNormal(uncertainty.avgUnitsPerOperator.mean, uncertainty.avgUnitsPerOperator.std), 8, 40),
                    pilotsPerMonth: clamp(randomNormal(uncertainty.pilotsPerMonth.mean, uncertainty.pilotsPerMonth.std), 1, 10),
                    gigPayout: clamp(randomNormal(uncertainty.gigPayout.mean, uncertainty.gigPayout.std), 70, 150)
                };
                
                // Run projection with sampled assumptions
                const originalAssumptions = JSON.parse(JSON.stringify(assumptions));
                Object.assign(assumptions, simAssumptions);
                
                const data = calculateProjection();
                const y1EBITDA = sum(data, 'ebitda');
                const y1Revenue = sum(data, 'revenue');
                const endUnits = data[11]?.netUnits || 0;
                
                // Find break-even month
                let breakEven = null;
                for (let m = 0; m < 12; m++) {
                    if (data[m]?.ebitda > 0) {
                        breakEven = m + 1;
                        break;
                    }
                }
                
                // Calculate funding need
                const lowestCash = Math.min(...data.map(d => d.cumCash));
                const peakDeficit = Math.abs(Math.min(0, lowestCash));
                const fundingNeed = computeFundingNeed(peakDeficit);
                
                results.ebitda.push(y1EBITDA);
                results.revenue.push(y1Revenue);
                results.units.push(endUnits);
                results.breakEven.push(breakEven);
                results.fundingNeed.push(fundingNeed);
                
                // Restore original assumptions
                Object.assign(assumptions, originalAssumptions);
            }
            
            return results;
        }
        
        function displayMonteCarloResults(results) {
            const n = results.ebitda.length;
            
            // Sort for percentile calculations
            const sortedEbitda = [...results.ebitda].sort((a, b) => a - b);
            const sortedUnits = [...results.units].sort((a, b) => a - b);
            const sortedRevenue = [...results.revenue].sort((a, b) => a - b);
            const sortedFunding = [...results.fundingNeed].sort((a, b) => a - b);
            
            // Calculate percentiles
            const p10Idx = Math.floor(n * 0.1);
            const p20Idx = Math.floor(n * 0.2);
            const p50Idx = Math.floor(n * 0.5);
            const p80Idx = Math.floor(n * 0.8);
            const p90Idx = Math.floor(n * 0.9);
            
            const ebitdaP10 = sortedEbitda[p10Idx];
            const ebitdaP50 = sortedEbitda[p50Idx];
            const ebitdaP90 = sortedEbitda[p90Idx];
            
            // Calculate probabilities
            const probProfit = (results.ebitda.filter(e => e > 0).length / n * 100).toFixed(0);
            const probBreakEven = (results.breakEven.filter(b => b !== null).length / n * 100).toFixed(0);
            const probUnits200 = (results.units.filter(u => u >= 200).length / n * 100).toFixed(0);
            const probFundingSufficient = (results.fundingNeed.filter(f => f <= 85000).length / n * 100).toFixed(0);
            const probRevenue500K = (results.revenue.filter(r => r >= 500000).length / n * 100).toFixed(0);
            
            // DECISION RULE 1: Funding for 80% confidence
            const funding80 = sortedFunding[p80Idx];
            document.getElementById('mc-funding-80').textContent = 'AED ' + fmt(funding80);
            const fundingCard = document.getElementById('mc-decision-funding');
            if (funding80 <= 85000) {
                fundingCard.className = 'mc-decision-card success';
                document.getElementById('mc-funding-80-action').textContent = 'âœ“ Current ask (AED 85K) is sufficient';
            } else if (funding80 <= 120000) {
                fundingCard.className = 'mc-decision-card';
                document.getElementById('mc-funding-80-action').textContent = 'âš  Consider raising ask to AED ' + fmt(Math.ceil(funding80 / 10000) * 10000);
            } else {
                fundingCard.className = 'mc-decision-card danger';
                document.getElementById('mc-funding-80-action').textContent = 'âš  Significantly more funding may be needed';
            }
            
            // DECISION RULE 2: Kill zone probability (M12 < 100 properties)
            const probKillZone = (results.units.filter(u => u < 100).length / n * 100).toFixed(0);
            document.getElementById('mc-kill-prob').textContent = probKillZone + '%';
            const killCard = document.getElementById('mc-decision-kill');
            if (probKillZone <= 20) {
                killCard.className = 'mc-decision-card success';
                document.getElementById('mc-kill-action').textContent = 'âœ“ Low risk of hitting kill threshold';
            } else if (probKillZone <= 40) {
                killCard.className = 'mc-decision-card';
                document.getElementById('mc-kill-action').textContent = 'âš  Moderate risk â€” monitor closely';
            } else {
                killCard.className = 'mc-decision-card danger';
                document.getElementById('mc-kill-action').textContent = 'âš  High risk â€” revisit assumptions or strategy';
            }
            
            // Expected values
            const expectedEbitda = results.ebitda.reduce((a, b) => a + b, 0) / n;
            const avgBreakEven = results.breakEven.filter(b => b !== null);
            const expectedBE = avgBreakEven.length > 0 
                ? 'M' + Math.round(avgBreakEven.reduce((a, b) => a + b, 0) / avgBreakEven.length)
                : 'N/A';
            
            // Update summary cards
            document.getElementById('mc-prob-profit').textContent = probProfit + '%';
            document.getElementById('mc-expected-ebitda').textContent = 'AED ' + fmt(expectedEbitda);
            document.getElementById('mc-ebitda-range').textContent = `P10: ${fmt(ebitdaP10)} | P90: ${fmt(ebitdaP90)}`;
            document.getElementById('mc-expected-be').textContent = expectedBE;
            document.getElementById('mc-be-prob').textContent = probBreakEven + '% achieve in Y1';
            document.getElementById('mc-funding-conf').textContent = probFundingSufficient + '%';
            
            // Update percentile values
            document.getElementById('mc-ebitda-p10').textContent = 'AED ' + fmt(ebitdaP10);
            document.getElementById('mc-ebitda-p50').textContent = 'AED ' + fmt(ebitdaP50);
            document.getElementById('mc-ebitda-p90').textContent = 'AED ' + fmt(ebitdaP90);
            
            // Build histogram
            const histogramEl = document.getElementById('mc-ebitda-histogram');
            const minEbitda = Math.min(...results.ebitda);
            const maxEbitda = Math.max(...results.ebitda);
            const bucketCount = 30;
            const bucketSize = (maxEbitda - minEbitda) / bucketCount;
            const buckets = new Array(bucketCount).fill(0);
            
            results.ebitda.forEach(e => {
                const bucketIdx = Math.min(Math.floor((e - minEbitda) / bucketSize), bucketCount - 1);
                buckets[bucketIdx]++;
            });
            
            const maxBucket = Math.max(...buckets);
            const zeroIdx = Math.floor((0 - minEbitda) / bucketSize);
            
            histogramEl.innerHTML = buckets.map((count, idx) => {
                const height = (count / maxBucket * 100).toFixed(1);
                const isNegative = (minEbitda + idx * bucketSize) < 0;
                const isMedian = idx === Math.floor((ebitdaP50 - minEbitda) / bucketSize);
                return `<div class="mc-bar ${isNegative ? 'negative' : ''} ${isMedian ? 'highlight' : ''}" 
                            style="height: ${height}%"
                            title="${fmt(minEbitda + idx * bucketSize)} - ${fmt(minEbitda + (idx + 1) * bucketSize)}: ${count} iterations"></div>`;
            }).join('');
            
            // Update axis labels
            document.getElementById('mc-ebitda-min').textContent = fmt(minEbitda);
            document.getElementById('mc-ebitda-max').textContent = fmt(maxEbitda);
            
            // Update probability bars
            function updateProbBar(barId, valId, prob) {
                const bar = document.getElementById(barId);
                const val = document.getElementById(valId);
                bar.style.width = prob + '%';
                bar.className = 'mc-prob-bar-fill ' + (prob >= 70 ? 'high' : prob >= 40 ? 'medium' : 'low');
                val.textContent = prob + '%';
            }
            
            updateProbBar('mc-prob-be-bar', 'mc-prob-be-val', probBreakEven);
            updateProbBar('mc-prob-units-bar', 'mc-prob-units-val', probUnits200);
            updateProbBar('mc-prob-fund-bar', 'mc-prob-fund-val', probFundingSufficient);
            updateProbBar('mc-prob-rev-bar', 'mc-prob-rev-val', probRevenue500K);
            
            // STRESS TESTS
            runStressTests();
            
            // ASSUMPTIONS TRANSPARENCY
            displayAssumptionRanges();
        }
        
        function runStressTests() {
            const baseA = JSON.parse(JSON.stringify(assumptions));
            
            // Helper to run single projection and get key metrics
            function runScenario(modifiedAssumptions) {
                const original = JSON.parse(JSON.stringify(assumptions));
                Object.assign(assumptions, modifiedAssumptions);
                const data = calculateProjection();
                const y1EBITDA = sum(data, 'ebitda');
                const endUnits = data[11]?.netUnits || 0;
                let breakEven = null;
                for (let m = 0; m < 12; m++) {
                    if (data[m]?.ebitda > 0) { breakEven = m + 1; break; }
                }
                Object.assign(assumptions, original);
                return { ebitda: y1EBITDA, units: endUnits, breakEven };
            }
            
            // Base case
            const base = runScenario(baseA);
            
            // Stress 1: Churn 50% worse
            const churnStress = runScenario({ ...baseA, churnRate: baseA.churnRate * 1.5 });
            const churnEl = document.getElementById('mc-stress-churn');
            const churnDiff = churnStress.ebitda - base.ebitda;
            churnEl.innerHTML = `Break-even: <strong>${churnStress.breakEven ? 'M' + churnStress.breakEven : 'Not achieved'}</strong><br>
                EBITDA impact: <strong>${churnDiff >= 0 ? '+' : ''}AED ${fmt(churnDiff)}</strong><br>
                M12 properties: <strong>${Math.round(churnStress.units)}</strong>`;
            churnEl.className = 'mc-stress-result' + (churnStress.units < 100 ? ' danger' : churnDiff < -50000 ? ' warning' : '');
            
            // Stress 2: Price 20% lower
            const priceStress = runScenario({ ...baseA, price: baseA.price * 0.8 });
            const priceEl = document.getElementById('mc-stress-price');
            const priceDiff = priceStress.ebitda - base.ebitda;
            priceEl.innerHTML = `Break-even: <strong>${priceStress.breakEven ? 'M' + priceStress.breakEven : 'Not achieved'}</strong><br>
                EBITDA impact: <strong>${priceDiff >= 0 ? '+' : ''}AED ${fmt(priceDiff)}</strong><br>
                M12 properties: <strong>${Math.round(priceStress.units)}</strong>`;
            priceEl.className = 'mc-stress-result' + (priceStress.units < 100 ? ' danger' : priceDiff < -50000 ? ' warning' : '');
            
            // Stress 3: Conversion 30% worse
            const convStress = runScenario({ ...baseA, conversionRate: baseA.conversionRate * 0.7 });
            const convEl = document.getElementById('mc-stress-conversion');
            const convDiff = convStress.ebitda - base.ebitda;
            convEl.innerHTML = `Break-even: <strong>${convStress.breakEven ? 'M' + convStress.breakEven : 'Not achieved'}</strong><br>
                EBITDA impact: <strong>${convDiff >= 0 ? '+' : ''}AED ${fmt(convDiff)}</strong><br>
                M12 properties: <strong>${Math.round(convStress.units)}</strong>`;
            convEl.className = 'mc-stress-result' + (convStress.units < 100 ? ' danger' : convDiff < -50000 ? ' warning' : '');
        }
        
        function displayAssumptionRanges() {
            const a = assumptions;
            const ranges = [
                { label: 'Price', range: `${Math.round(a.price * 0.85)} - ${Math.round(a.price * 1.15)}` },
                { label: 'Conversion', range: `${Math.round(a.conversionRate - 12)}% - ${Math.round(a.conversionRate + 12)}%` },
                { label: 'Churn', range: `${Math.max(2, Math.round(a.churnRate - 3))}% - ${Math.round(a.churnRate + 3)}%` },
                { label: 'Props/Manager', range: `${Math.round(a.avgUnitsPerOperator - 5)} - ${Math.round(a.avgUnitsPerOperator + 5)}` },
                { label: 'Pilots/Month', range: `${Math.max(1, Math.round(a.pilotsPerMonth - 1.5))} - ${Math.round(a.pilotsPerMonth + 1.5)}` },
                { label: 'Gig Payout', range: `${Math.round(a.gigPayout - 15)} - ${Math.round(a.gigPayout + 15)}` }
            ];
            
            document.getElementById('mc-assumptions-grid').innerHTML = ranges.map(r => `
                <div class="mc-assumption-item">
                    <span class="mc-assumption-label">${r.label}</span>
                    <span class="mc-assumption-range">${r.range}</span>
                </div>
            `).join('');
        }
        
        function updateSensitivityAnalysis(baseData) {
            const a = assumptions;
            const baseEBITDA = sum(baseData, 'ebitda');
            
            // Skip if base EBITDA is 0 to avoid division issues
            if (baseEBITDA === 0) {
                document.getElementById('sensitivity-grid').innerHTML = '<p style="color: var(--gray-500); text-align: center; padding: 20px;">Base case is at roughly break-even. Adjust price or churn to see which levers matter most.</p>';
                return;
            }
            
            // Store original values
            const originalAssumptions = JSON.parse(JSON.stringify(assumptions));
            
            // Variables to test
            const variables = [
                { name: 'Price (AED)', key: 'price', base: originalAssumptions.price, delta: 0.20 },
                { name: 'Churn Rate (%)', key: 'churnRate', base: originalAssumptions.churnRate, delta: 0.25, inverse: true },
                { name: 'Conversion (%)', key: 'conversionRate', base: originalAssumptions.conversionRate, delta: 0.20 },
                { name: 'Properties per Manager', key: 'avgUnitsPerOperator', base: originalAssumptions.avgUnitsPerOperator, delta: 0.20 },
                { name: 'Gig Payout', key: 'gigPayout', base: originalAssumptions.gigPayout, delta: 0.20, inverse: true }
            ];
            
            let results = [];
            
            try {
                variables.forEach(v => {
                    // Reset to original before each test
                    Object.assign(assumptions, originalAssumptions);
                    
                    // Test -20%
                    const lowValue = v.base * (1 - v.delta);
                    assumptions[v.key] = lowValue;
                    const lowData = calculateProjection();
                    const lowEBITDA = sum(lowData, 'ebitda');
                    
                    // Reset to original
                    Object.assign(assumptions, originalAssumptions);
                    
                    // Test +20%
                    const highValue = v.base * (1 + v.delta);
                    assumptions[v.key] = highValue;
                    const highData = calculateProjection();
                    const highEBITDA = sum(highData, 'ebitda');
                    
                    // Reset to original
                    Object.assign(assumptions, originalAssumptions);
                    
                    // Calculate impact
                    const lowImpact = ((lowEBITDA - baseEBITDA) / Math.abs(baseEBITDA)) * 100;
                    const highImpact = ((highEBITDA - baseEBITDA) / Math.abs(baseEBITDA)) * 100;
                    
                    // For inverse variables (where lower is better), swap the impacts
                    const negImpact = v.inverse ? highImpact : lowImpact;
                    const posImpact = v.inverse ? lowImpact : highImpact;
                    
                    const totalSwing = Math.abs(posImpact - negImpact);
                    
                    results.push({
                        name: v.name,
                        negImpact: negImpact,
                        posImpact: posImpact,
                        totalSwing: totalSwing,
                        lowVal: v.inverse ? Math.round(highValue) : Math.round(lowValue),
                        highVal: v.inverse ? Math.round(lowValue) : Math.round(highValue)
                    });
                });
            } finally {
                // ALWAYS restore original assumptions
                Object.assign(assumptions, originalAssumptions);
            }
            
            // Sort by impact
            results.sort((a, b) => b.totalSwing - a.totalSwing);
            
            // Render rows
            const grid = document.getElementById('sensitivity-grid');
            grid.innerHTML = results.map(r => {
                const negWidth = Math.min(Math.abs(r.negImpact) / 2, 45);
                const posWidth = Math.min(Math.abs(r.posImpact) / 2, 45);
                
                let impactLevel = 'low';
                if (r.totalSwing > 80) impactLevel = 'critical';
                else if (r.totalSwing > 50) impactLevel = 'high';
                else if (r.totalSwing > 25) impactLevel = 'medium';
                
                return `
                    <div class="sensitivity-row">
                        <div class="sensitivity-variable">${r.name}</div>
                        <div class="sensitivity-bar-wrap">
                            <div class="sensitivity-bar-center"></div>
                            <div class="sensitivity-bar-negative" style="width: ${negWidth}%">
                                <span class="sensitivity-bar-label">${r.negImpact > 0 ? '+' : ''}${Math.round(r.negImpact)}%</span>
                            </div>
                            <div class="sensitivity-bar-positive" style="width: ${posWidth}%">
                                <span class="sensitivity-bar-label">${r.posImpact > 0 ? '+' : ''}${Math.round(r.posImpact)}%</span>
                            </div>
                        </div>
                        <div class="sensitivity-impact">
                            <span class="impact-badge ${impactLevel}">${impactLevel.toUpperCase()}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update insight - make it scenario-aware and logically consistent
            const topVar = results[0];
            const insightEl = document.getElementById('sensitivity-insight');
            
            // Get current Y1 EBITDA to check if we're profitable
            const projData = calculateProjection();
            const y1EBITDA = sum(projData, 'ebitda');
            const isLossMaking = y1EBITDA < 0;
            
            // Scenario-specific insights
            if (currentScenario === 'bear') {
                // Bear scenario - always show caution
                insightEl.innerHTML = `
                    <div class="insight-icon">âš ï¸</div>
                    <div class="insight-content">
                        <h4>Bear Case Warning</h4>
                        <p>This conservative scenario shows <strong>${isLossMaking ? 'significant losses' : 'marginal performance'}</strong>. Key risks: low conversion (${assumptions.conversionRate}%), high churn (${assumptions.churnRate}%), and limited growth capacity. <strong>Validate pessimistic assumptions</strong> before ruling out the opportunity.</p>
                    </div>
                `;
                insightEl.style.background = 'linear-gradient(135deg, #fef2f2 0%, #fff 100%)';
                insightEl.style.borderColor = '#fecaca';
            } else if (currentScenario === 'bull') {
                // Bull scenario - note optimism
                insightEl.innerHTML = `
                    <div class="insight-icon">ðŸŽ¯</div>
                    <div class="insight-content">
                        <h4>Bull Case Assumptions</h4>
                        <p>This optimistic scenario assumes <strong>${assumptions.conversionRate}% conversion</strong> and <strong>${assumptions.churnRate}% churn</strong>. Reality typically falls between Base and Bull. <strong>Don't plan funding</strong> around best-case projections.</p>
                    </div>
                `;
                insightEl.style.background = 'linear-gradient(135deg, #f0fdf4 0%, #fff 100%)';
                insightEl.style.borderColor = '#bbf7d0';
            } else if (topVar && topVar.totalSwing > 50) {
                // Base scenario with high sensitivity
                insightEl.innerHTML = `
                    <div class="insight-icon">âš¡</div>
                    <div class="insight-content">
                        <h4>Highest Risk: ${topVar.name}</h4>
                        <p>A <strong>20% change in ${topVar.name.toLowerCase()}</strong> swings Y1 EBITDA by up to <strong>${Math.round(topVar.totalSwing)}%</strong>. This is the #1 variable to validate and de-risk before scaling.</p>
                    </div>
                `;
                insightEl.style.background = 'linear-gradient(135deg, #fffbeb 0%, #fff 100%)';
                insightEl.style.borderColor = '#fde68a';
            } else if (isLossMaking) {
                // Base scenario, not profitable
                insightEl.innerHTML = `
                    <div class="insight-icon">ðŸ“Š</div>
                    <div class="insight-content">
                        <h4>Path to Profitability</h4>
                        <p>Base case shows Y1 losses of <strong>AED ${fmt(Math.abs(y1EBITDA))}</strong>. Focus on improving <strong>conversion rate</strong> and <strong>reducing churn</strong> to reach break-even faster.</p>
                    </div>
                `;
                insightEl.style.background = 'linear-gradient(135deg, #eff6ff 0%, #fff 100%)';
                insightEl.style.borderColor = '#bfdbfe';
            } else {
                // Base scenario, profitable, robust
                insightEl.innerHTML = `
                    <div class="insight-icon">âœ…</div>
                    <div class="insight-content">
                        <h4>Model is Robust</h4>
                        <p>No single variable swings EBITDA by more than 50%. The model shows good resilience to assumption changes.</p>
                    </div>
                `;
                insightEl.style.background = 'linear-gradient(135deg, #f0fdf4 0%, #fff 100%)';
                insightEl.style.borderColor = '#bbf7d0';
            }
        }
        
        function calculateMultiYearProjection(y1Data) {
            const a = assumptions;
            const ma = multiYearAssumptions;
            const gigCostPerUnit = a.gigPayout + a.platformFee;
            const y1FixedCosts = a.founderSalary + (a.teamSalaries || 0) + a.marketing + a.tech + a.office;
            
            // Y1 totals
            const y1Revenue = sum(y1Data, 'revenue');
            const y1EBITDA = sum(y1Data, 'ebitda');
            const y1EndUnits = y1Data[11].netUnits;
            const y1EndOperators = y1Data[11].totalOperators;
            const y1LaborCost = sum(y1Data, 'laborCost');
            
            // Y2 Projections
            const y2ChurnRate = a.churnRate * (1 - ma.churnImprovement / 100);
            const y2FixedCosts = y1FixedCosts * (1 + ma.fixedCostGrowth / 100) + (ma.y2Hires * ma.avgHireSalary);
            
            let y2Units = y1EndUnits;
            let y2Operators = y1EndOperators;
            let y2Revenue = 0;
            let y2LaborCost = 0;
            
            for (let m = 0; m < 12; m++) {
                const newUnits = Math.round(y2Units * (ma.y2GrowthRate / 100));
                y2Units += newUnits;
                const churnLoss = Math.round(y2Units * (y2ChurnRate / 100));
                y2Units -= churnLoss;
                y2Revenue += y2Units * a.price;
                y2LaborCost += y2Units * gigCostPerUnit * 0.9; // 10% efficiency gain
            }
            y2Operators = Math.round(y2Units / a.avgUnitsPerOperator);
            const y2EBITDA = y2Revenue - y2LaborCost - (y2FixedCosts * 12);
            
            // Y3 Projections
            const y3ChurnRate = y2ChurnRate * (1 - ma.churnImprovement / 100);
            const y3FixedCosts = y2FixedCosts * (1 + ma.fixedCostGrowth / 100) + (ma.y3Hires * ma.avgHireSalary);
            
            let y3Units = y2Units;
            let y3Revenue = 0;
            let y3LaborCost = 0;
            
            for (let m = 0; m < 12; m++) {
                const newUnits = Math.round(y3Units * (ma.y3GrowthRate / 100));
                y3Units += newUnits;
                const churnLoss = Math.round(y3Units * (y3ChurnRate / 100));
                y3Units -= churnLoss;
                y3Revenue += y3Units * a.price;
                y3LaborCost += y3Units * gigCostPerUnit * 0.8; // 20% efficiency gain
            }
            const y3Operators = Math.round(y3Units / a.avgUnitsPerOperator);
            const y3EBITDA = y3Revenue - y3LaborCost - (y3FixedCosts * 12);
            
            const y3ARR = y3Units * a.price * 12;
            const valuation = y3ARR * 4;
            
            return {
                y1: { revenue: y1Revenue, ebitda: y1EBITDA, units: y1EndUnits, operators: y1EndOperators },
                y2: { revenue: y2Revenue, ebitda: y2EBITDA, units: y2Units, operators: y2Operators },
                y3: { revenue: y3Revenue, ebitda: y3EBITDA, units: y3Units, operators: y3Operators },
                arr: y3ARR,
                valuation: valuation
            };
        }
        
        function updateMultiYearProjection(y1Data) {
            const proj = calculateMultiYearProjection(y1Data);
            
            // Year cards
            document.getElementById('y1-revenue').textContent = 'AED ' + fmt(proj.y1.revenue);
            document.getElementById('y1-ebitda').textContent = 'AED ' + fmt(proj.y1.ebitda);
            document.getElementById('y1-units').textContent = proj.y1.units;
            document.getElementById('y1-operators').textContent = proj.y1.operators;
            
            document.getElementById('y2-revenue').textContent = 'AED ' + fmt(proj.y2.revenue);
            document.getElementById('y2-ebitda').textContent = 'AED ' + fmt(proj.y2.ebitda);
            document.getElementById('y2-units').textContent = proj.y2.units;
            document.getElementById('y2-operators').textContent = proj.y2.operators;
            
            document.getElementById('y3-revenue').textContent = 'AED ' + fmt(proj.y3.revenue);
            document.getElementById('y3-ebitda').textContent = 'AED ' + fmt(proj.y3.ebitda);
            document.getElementById('y3-units').textContent = proj.y3.units;
            document.getElementById('y3-operators').textContent = proj.y3.operators;
            
            // Progress bars
            const maxRev = proj.y3.revenue;
            document.getElementById('y1-bar').style.width = (proj.y1.revenue / maxRev * 100) + '%';
            document.getElementById('y2-bar').style.width = (proj.y2.revenue / maxRev * 100) + '%';
            document.getElementById('y3-bar').style.width = '100%';
            
            // Valuation
            document.getElementById('val-arr').textContent = 'AED ' + fmt(proj.arr);
            document.getElementById('val-total').textContent = 'AED ' + fmt(proj.valuation);
            
            // Detailed table
            updateProjectionTable(proj);
            
            // Chart
            updateProjectionChart(proj);
        }
        
        function updateProjectionTable(proj) {
            const total3yr = {
                revenue: proj.y1.revenue + proj.y2.revenue + proj.y3.revenue,
                ebitda: proj.y1.ebitda + proj.y2.ebitda + proj.y3.ebitda
            };
            
            const rows = [
                { label: 'Revenue', y1: proj.y1.revenue, y2: proj.y2.revenue, y3: proj.y3.revenue, total: total3yr.revenue },
                { label: 'EBITDA', y1: proj.y1.ebitda, y2: proj.y2.ebitda, y3: proj.y3.ebitda, total: total3yr.ebitda, highlight: true },
                { label: 'End Properties', y1: proj.y1.units, y2: proj.y2.units, y3: proj.y3.units, total: proj.y3.units, isUnits: true },
                { label: 'Managers', y1: proj.y1.operators, y2: proj.y2.operators, y3: proj.y3.operators, total: proj.y3.operators, isUnits: true }
            ];
            
            let html = '';
            rows.forEach(r => {
                const cls = r.highlight ? 'total-row' : '';
                const y1Cls = !r.isUnits && r.y1 < 0 ? 'negative' : (!r.isUnits && r.y1 > 0 && r.highlight ? 'positive' : '');
                const y2Cls = !r.isUnits && r.y2 < 0 ? 'negative' : (!r.isUnits && r.y2 > 0 && r.highlight ? 'positive' : '');
                const y3Cls = !r.isUnits && r.y3 < 0 ? 'negative' : (!r.isUnits && r.y3 > 0 && r.highlight ? 'positive' : '');
                const tCls = !r.isUnits && r.total < 0 ? 'negative' : (!r.isUnits && r.total > 0 && r.highlight ? 'positive' : '');
                
                html += `<tr class="${cls}">
                    <td>${r.label}</td>
                    <td class="${y1Cls}">${r.isUnits ? r.y1.toLocaleString() : 'AED ' + fmt(r.y1)}</td>
                    <td class="${y2Cls}">${r.isUnits ? r.y2.toLocaleString() : 'AED ' + fmt(r.y2)}</td>
                    <td class="${y3Cls}">${r.isUnits ? r.y3.toLocaleString() : 'AED ' + fmt(r.y3)}</td>
                    <td class="${tCls}"><strong>${r.isUnits ? r.total.toLocaleString() : 'AED ' + fmt(r.total)}</strong></td>
                </tr>`;
            });
            
            document.getElementById('projection-table-body').innerHTML = html;
        }
        
        function updateProjectionChart(proj) {
            const ctx = document.getElementById('projectionChart');
            if (!ctx) return;
            
            if (projectionChart) projectionChart.destroy();
            
            // Scenario-specific colors
            const scenarioColors = {
                bear: {
                    barBg: ['rgba(239,68,68,0.3)', 'rgba(239,68,68,0.4)', 'rgba(239,68,68,0.5)'],
                    barBorder: ['#f87171', '#ef4444', '#dc2626'],
                    line: '#dc2626',
                    point: '#dc2626'
                },
                base: {
                    barBg: ['rgba(139,92,246,0.4)', 'rgba(222,255,154,0.5)', 'rgba(34,197,94,0.4)'],
                    barBorder: ['#8b5cf6', '#c5e86c', '#22c55e'],
                    line: '#18181b',
                    point: '#18181b'
                },
                bull: {
                    barBg: ['rgba(34,197,94,0.3)', 'rgba(34,197,94,0.45)', 'rgba(34,197,94,0.6)'],
                    barBorder: ['#4ade80', '#22c55e', '#16a34a'],
                    line: '#16a34a',
                    point: '#16a34a'
                }
            };
            
            const colors = scenarioColors[currentScenario] || scenarioColors.base;
            
            projectionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3'],
                    datasets: [
                        {
                            label: 'Revenue',
                            data: [proj.y1.revenue, proj.y2.revenue, proj.y3.revenue],
                            backgroundColor: colors.barBg,
                            borderColor: colors.barBorder,
                            borderWidth: 2,
                            borderRadius: 6,
                            order: 2
                        },
                        {
                            label: 'EBITDA',
                            data: [proj.y1.ebitda, proj.y2.ebitda, proj.y3.ebitda],
                            type: 'line',
                            borderColor: colors.line,
                            backgroundColor: 'transparent',
                            borderWidth: 3,
                            pointBackgroundColor: colors.point,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            tension: 0.3,
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#6b7280', usePointStyle: true, font: { size: 11 } }
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#9ca3af', font: { size: 11, weight: '600' } } },
                        y: { grid: { color: '#eef1f4' }, ticks: { color: '#9ca3af', font: { size: 10 }, callback: v => (v/1e6).toFixed(1) + 'M' } }
                    }
                }
            });
        }

        function updateDashboard() {
            const data = calculateProjection();
            const y1Rev = sum(data, 'revenue');
            const y1EBITDA = sum(data, 'ebitda');
            const y1GP = sum(data, 'grossProfit');
            const y1Labor = sum(data, 'laborCost');
            const endUnits = data[11].netUnits;
            const endOperators = data[11].totalOperators;
            const breakEven = findBreakEven(data);
            const lowestCash = Math.min(...data.map(d => d.cumCash));
            const peakDeficit = Math.abs(Math.min(0, lowestCash));
            const endCash = data[11].cumCash;
            const grossMargin = y1GP / y1Rev;
            
            // Use unified funding calculation
            const fundingNeeded = computeFundingNeed(peakDeficit);
            const fundingText = fundingNeeded > 0 ? 'AED ' + fmt(fundingNeeded) : (peakDeficit > 0 ? 'Minimal' : 'None');
            
            // Unit Economics Metrics
            const avgLifespan = 1 / (assumptions.churnRate / 100);
            const contributionPerUnit = assumptions.price - (assumptions.gigPayout + assumptions.platformFee);
            // LTV: contribution margin per property Ã— expected lifespan in months
            const ltv = contributionPerUnit * avgLifespan;
            // CAC: marketing spend per property acquired (both at property level for consistency)
            const cac = (assumptions.marketing * 12) / Math.max(1, endUnits);
            const ltvCac = ltv / cac;
            const payback = cac / contributionPerUnit; // Months to recoup acquisition cost
            // EBITDA Margin
            const ebitdaMargin = y1Rev > 0 ? (y1EBITDA / y1Rev) * 100 : 0;
            
            // Key Assumptions Display
            document.getElementById('assumption-price').textContent = 'AED ' + assumptions.price + '/property';
            document.getElementById('assumption-units').textContent = assumptions.avgUnitsPerOperator + ' properties/mgr';
            document.getElementById('assumption-conversion').textContent = assumptions.conversionRate + '% conv';
            document.getElementById('assumption-churn').textContent = assumptions.churnRate + '% churn';
            
            // Executive Summary
            document.getElementById('scenario-name').textContent = scenarios[currentScenario].name;
            document.getElementById('exec-summary').className = 'executive-summary ' + currentScenario;
            
            const beText = breakEven ? `Month ${breakEven}` : 'Not in Y1';
            const ebitdaText = 'AED ' + fmt(y1EBITDA);
            
            // Update hero sentence elements
            document.getElementById('exec-price').textContent = assumptions.price;
            document.getElementById('exec-units').textContent = endUnits;
            document.getElementById('exec-be-text').textContent = beText;
            document.getElementById('exec-ebitda-text').textContent = ebitdaText;
            document.getElementById('exec-funding-text').textContent = fundingText;
            
            // Update KPI cards
            document.getElementById('sum-be').textContent = beText;
            document.getElementById('sum-ebitda').textContent = ebitdaText;
            document.getElementById('sum-units').textContent = endUnits;
            document.getElementById('sum-funding').textContent = fundingText;
            
            // Comparison
            document.getElementById('comp-units').textContent = endUnits;
            document.getElementById('comp-revenue').textContent = 'AED ' + fmt(y1Rev);
            document.getElementById('comp-be').textContent = breakEven ? 'M' + breakEven : 'â€”';
            
            // Key Ratios (using TARGETS for maintainability)
            updateRatio('ratio-ltv', ltvCac.toFixed(1) + 'x', ltvCac >= TARGETS.ltvCacMin ? 'success' : ltvCac >= TARGETS.ltvCacOk ? 'warning' : 'danger', Math.min(ltvCac / 5 * 100, 100));
            updateRatio('ratio-payback', payback.toFixed(1) + ' mo', payback <= TARGETS.paybackMax ? 'success' : payback <= TARGETS.paybackOk ? 'warning' : 'danger', Math.min((1 - payback / 24) * 100, 100));
            updateRatio('ratio-gm', fmtPct(grossMargin), grossMargin >= TARGETS.grossMarginGood ? 'success' : grossMargin >= TARGETS.grossMarginOk ? 'warning' : 'danger', grossMargin * 100);
            updateRatio('ratio-ebitda-margin', Math.round(ebitdaMargin) + '%', ebitdaMargin >= TARGETS.ebitdaMarginGood ? 'success' : ebitdaMargin >= TARGETS.ebitdaMarginOk ? 'warning' : 'danger', Math.max(0, Math.min((ebitdaMargin + 20) / 40 * 100, 100)));
            
            document.getElementById('ratio-ltv-value').textContent = ltvCac.toFixed(1) + 'x';
            document.getElementById('ratio-payback-value').textContent = payback.toFixed(1) + ' mo';
            document.getElementById('ratio-gm-value').textContent = fmtPct(grossMargin);
            document.getElementById('ratio-ebitda-margin-value').textContent = Math.round(ebitdaMargin) + '%';
            
            // Milestones
            const ms = [
                { id: 1, actual: data[2]?.netUnits || 0, target: 35, kill: 15 },
                { id: 2, actual: data[5]?.netUnits || 0, target: 90, kill: 45 },
                { id: 3, actual: data[8]?.netUnits || 0, target: 150, kill: 75 },
                { id: 4, actual: data[11]?.netUnits || 0, target: 220, kill: 100 }
            ];
            
            ms.forEach(m => {
                document.getElementById(`ms${m.id}-target`).textContent = m.actual;
                document.getElementById(`ms${m.id}-base`).textContent = m.target;
                document.getElementById(`ms${m.id}-kill`).textContent = '< ' + m.kill;
                
                const el = document.getElementById(`milestone-${m.id}`);
                if (m.actual >= m.target) el.className = 'milestone on-track';
                else if (m.actual >= m.kill) el.className = 'milestone at-risk';
                else el.className = 'milestone off-track';
            });
            
            // Growth Summary
            document.getElementById('projected-operators').textContent = endOperators;
            document.getElementById('projected-avg').textContent = assumptions.avgUnitsPerOperator;
            document.getElementById('projected-m12').textContent = endUnits;
            
            // Unit Economics
            const avgLaborPerUnit = y1Labor / Math.max(1, sum(data, 'netUnits'));
            const totalUnitMonths = sum(data, 'netUnits');
            // Include ALL fixed costs (founder + team + marketing + tech + office)
            const fixedPerUnit = (assumptions.founderSalary + (assumptions.teamSalaries || 0) + assumptions.marketing + assumptions.tech + assumptions.office) * 12 / Math.max(1, totalUnitMonths);
            
            document.getElementById('ue-subtitle').textContent = 'Per property, per month at AED ' + assumptions.price;
            document.getElementById('ue-revenue').textContent = 'AED ' + assumptions.price;
            document.getElementById('ue-labor').textContent = 'â€“ AED ' + Math.round(avgLaborPerUnit);
            document.getElementById('ue-gp').textContent = 'AED ' + Math.round(assumptions.price - avgLaborPerUnit);
            document.getElementById('ue-fixed').textContent = 'â€“ AED ' + Math.round(fixedPerUnit);
            document.getElementById('ue-cm').textContent = 'AED ' + Math.round(assumptions.price - avgLaborPerUnit - fixedPerUnit);
            
            // Funding - use same calculation as fundingText for consistency
            document.getElementById('cash-deficit').textContent = 'AED ' + fmt(peakDeficit);
            // Buffer is 20% of peak deficit, same logic as computeFundingNeed
            const buffer = peakDeficit > 5000 ? Math.ceil((peakDeficit * 0.2) / 1000) * 1000 : 0;
            document.getElementById('cash-buffer').textContent = 'AED ' + fmt(buffer);
            document.getElementById('cash-raise').textContent = fundingText;
            document.getElementById('cash-be').textContent = beText;
            document.getElementById('cash-end').textContent = 'AED ' + fmt(endCash);
            
            // P&L Table
            updatePnLTable(data);
            
            // Scenario Comparison
            updateScenarioTable();
            
            // Charts
            updateCharts(data);
            
            // Multi-year projection
            updateMultiYearProjection(data);
            
            // NEW: Decision Box, Breakeven, Sensitivity
            updateDecisionBox(data, breakEven, peakDeficit, y1EBITDA);
            updateBreakevenHero(data, breakEven);
            updateSensitivityAnalysis(data);
        }

        function updateRatio(id, value, status, barWidth) {
            const el = document.getElementById(id);
            el.className = 'ratio-card ' + status;
            el.querySelector('.ratio-bar-fill').style.width = barWidth + '%';
        }

        function updatePnLTable(data) {
            const rows = [
                { label: 'Units', key: 'netUnits', format: v => v },
                { label: 'Revenue', key: 'revenue', format: v => Math.round(v/1000) + 'K' },
                { label: 'Labor Cost', key: 'laborCost', format: v => '-' + Math.round(v/1000) + 'K', cls: 'negative' },
                { label: 'Gross Profit', key: 'grossProfit', format: v => Math.round(v/1000) + 'K', cls: 'subtotal-row' },
                { label: 'Fixed Costs', key: 'fixedCosts', format: v => '-' + Math.round(v/1000) + 'K', cls: 'negative' },
                { label: 'EBITDA', key: 'ebitda', format: v => (v >= 0 ? '' : '-') + Math.round(Math.abs(v)/1000) + 'K', cls: 'total-row' },
                { label: 'Cum. Cash', key: 'cumCash', format: v => (v >= 0 ? '' : '-') + Math.round(Math.abs(v)/1000) + 'K' }
            ];
            
            let html = '';
            rows.forEach(r => {
                html += `<tr class="${r.cls || ''}"><td class="row-label">${r.label}</td>`;
                data.forEach(d => {
                    const v = d[r.key];
                    const cls = (r.key === 'ebitda' || r.key === 'cumCash') ? (v >= 0 ? 'positive' : 'negative') : '';
                    html += `<td class="${cls}">${r.format(v)}</td>`;
                });
                const total = sum(data, r.key);
                const tcls = (r.key === 'ebitda' || r.key === 'cumCash') ? (total >= 0 ? 'positive' : 'negative') : '';
                html += `<td class="${tcls}"><strong>${r.key === 'netUnits' ? data[11].netUnits : r.format(total)}</strong></td></tr>`;
            });
            document.getElementById('pnl-body').innerHTML = html;
        }

        function updateScenarioTable() {
            Object.keys(scenarios).forEach(key => {
                const s = scenarios[key];
                const origA = { ...assumptions };
                Object.assign(assumptions, s.assumptions);
                const d = calculateProjection();
                Object.assign(assumptions, origA);
                
                const y1Rev = sum(d, 'revenue');
                const y1EBITDA = sum(d, 'ebitda');
                const be = findBreakEven(d);
                const low = Math.min(...d.map(x => x.cumCash));
                
                document.getElementById(`sc-${key}-price`).textContent = 'AED ' + s.assumptions.price;
                document.getElementById(`sc-${key}-units`).textContent = d[11].netUnits;
                document.getElementById(`sc-${key}-rev`).textContent = 'AED ' + fmt(y1Rev);
                
                const eEl = document.getElementById(`sc-${key}-ebitda`);
                eEl.textContent = (y1EBITDA < 0 ? '-' : '') + 'AED ' + fmt(Math.abs(y1EBITDA));
                eEl.className = 'value ' + (y1EBITDA >= 0 ? 'positive' : 'negative');
                
                document.getElementById(`sc-${key}-be`).textContent = be ? `Month ${be}` : 'Never (Y1)';
                document.getElementById(`sc-${key}-cash`).textContent = 'AED ' + fmt(computeFundingNeed(Math.abs(Math.min(0, low))));
            });
        }

        function updateCharts(data) {
            const labels = ['M1','M2','M3','M4','M5','M6','M7','M8','M9','M10','M11','M12'];
            
            // Scenario-specific colors for monthly charts
            const monthlyColors = {
                bear: { positive: 'rgba(239,68,68,0.5)', positiveBorder: '#ef4444', negative: 'rgba(239,68,68,0.3)', negativeBorder: '#fca5a5', line: '#dc2626', lineBg: 'rgba(239,68,68,0.1)' },
                base: { positive: 'rgba(139,92,246,0.6)', positiveBorder: '#8b5cf6', negative: 'rgba(239,68,68,0.3)', negativeBorder: '#ef4444', line: '#8b5cf6', lineBg: 'rgba(139,92,246,0.1)' },
                bull: { positive: 'rgba(34,197,94,0.5)', positiveBorder: '#22c55e', negative: 'rgba(239,68,68,0.3)', negativeBorder: '#ef4444', line: '#22c55e', lineBg: 'rgba(34,197,94,0.1)' }
            };
            
            const mColors = monthlyColors[currentScenario] || monthlyColors.base;
            
            if (ebitdaChart) ebitdaChart.destroy();
            ebitdaChart = new Chart(document.getElementById('ebitdaChart'), {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        data: data.map(d => d.ebitda),
                        backgroundColor: data.map(d => d.ebitda >= 0 ? mColors.positive : mColors.negative),
                        borderColor: data.map(d => d.ebitda >= 0 ? mColors.positiveBorder : mColors.negativeBorder),
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#eef1f4' }, ticks: { color: '#9ca3af', font: { size: 10 } } },
                        y: { grid: { color: '#eef1f4' }, ticks: { color: '#9ca3af', font: { size: 10 }, callback: v => (v/1000).toFixed(0) + 'K' } }
                    }
                }
            });
            
            if (cashChart) cashChart.destroy();
            cashChart = new Chart(document.getElementById('cashChart'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Cumulative Cash',
                        data: data.map(d => d.cumCash),
                        borderColor: mColors.line,
                        backgroundColor: mColors.lineBg,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: data.map(d => d.cumCash >= 0 ? '#22c55e' : '#ef4444')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#eef1f4' }, ticks: { color: '#9ca3af', font: { size: 10 } } },
                        y: { grid: { color: '#eef1f4' }, ticks: { color: '#9ca3af', font: { size: 10 }, callback: v => (v/1000).toFixed(0) + 'K' } }
                    }
                }
            });
        }

        function applyScenario(key) {
            currentScenario = key;
            Object.assign(assumptions, scenarios[key].assumptions);
            currentPrice = assumptions.price;
            
            // Update UI
            document.querySelectorAll('.scenario-btn').forEach(b => {
                b.classList.toggle('active', b.dataset.scenario === key);
            });
            document.querySelectorAll('.price-btn').forEach(b => {
                b.classList.toggle('active', parseInt(b.dataset.price) === currentPrice);
            });
            document.getElementById('scenario-description').textContent = scenarios[key].description;
            
            // Update sliders
            updateSliderUI('slider-pilots', 'val-pilots', assumptions.pilotsPerMonth, '');
            updateSliderUI('slider-conversion', 'val-conversion', assumptions.conversionRate, '', false, '%');
            updateSliderUI('slider-avg-units', 'val-avg-units', assumptions.avgUnitsPerOperator, '');
            updateSliderUI('slider-churn', 'val-churn', assumptions.churnRate, '', false, '%');
            updateSliderUI('slider-gig-payout', 'val-gig-payout', assumptions.gigPayout, 'AED ');
            updateSliderUI('slider-platform-fee', 'val-platform-fee', assumptions.platformFee, 'AED ');
            updateSliderUI('slider-founder', 'val-founder', assumptions.founderSalary, 'AED ', true);
            updateSliderUI('slider-team', 'val-team', assumptions.teamSalaries || 0, 'AED ', true);
            updateSliderUI('slider-marketing', 'val-marketing', assumptions.marketing, 'AED ', true);
            updateSliderUI('slider-tech', 'val-tech', assumptions.tech, 'AED ', true);
            updateSliderUI('slider-office', 'val-office', assumptions.office, 'AED ', true);
            
            updateDashboard();
        }

        function updateSliderUI(id, valId, val, prefix, format = false, suffix = '') {
            const s = document.getElementById(id), v = document.getElementById(valId);
            if (s && v) {
                s.value = val;
                v.textContent = prefix + (format ? val.toLocaleString() : val) + suffix;
            }
        }

        function setupSlider(id, valId, key, prefix, format = false, suffix = '') {
            const s = document.getElementById(id), v = document.getElementById(valId);
            if (!s) return;
            s.addEventListener('input', () => {
                const val = parseInt(s.value);
                assumptions[key] = val;
                v.textContent = prefix + (format ? val.toLocaleString() : val) + suffix;
                updateDashboard();
            });
        }
        
        function setupMultiYearSlider(id, valId, key, prefix, suffix = '') {
            const s = document.getElementById(id), v = document.getElementById(valId);
            if (!s) return;
            s.addEventListener('input', () => {
                const val = parseInt(s.value);
                multiYearAssumptions[key] = val;
                v.textContent = prefix + val + suffix;
                updateDashboard();
            });
        }
        
        function setupMultiYearSliderK(id, valId, key) {
            const s = document.getElementById(id), v = document.getElementById(valId);
            if (!s) return;
            s.addEventListener('input', () => {
                const val = parseInt(s.value);
                multiYearAssumptions[key] = val;
                v.textContent = 'AED ' + (val/1000) + 'K';
                updateDashboard();
            });
        }

        function exportCSV() {
            const table = document.getElementById('pnl-table');
            let csv = [];
            for (let row of table.rows) {
                let cols = [];
                for (let cell of row.cells) cols.push('"' + cell.innerText.replace(/"/g, '""') + '"');
                csv.push(cols.join(','));
            }
            const blob = new Blob([csv.join('\n')], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lucas-financial-projection-validated.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            // Scenario buttons
            document.querySelectorAll('.scenario-btn').forEach(b => {
                b.addEventListener('click', () => applyScenario(b.dataset.scenario));
            });
            
            // Price buttons
            document.querySelectorAll('.price-btn').forEach(b => {
                b.addEventListener('click', () => {
                    document.querySelectorAll('.price-btn').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    assumptions.price = parseInt(b.dataset.price);
                    currentPrice = assumptions.price;
                    updateDashboard();
                });
            });
            
            // Sliders
            setupSlider('slider-pilots', 'val-pilots', 'pilotsPerMonth', '');
            setupSlider('slider-conversion', 'val-conversion', 'conversionRate', '', false, '%');
            setupSlider('slider-avg-units', 'val-avg-units', 'avgUnitsPerOperator', '');
            setupSlider('slider-churn', 'val-churn', 'churnRate', '', false, '%');
            setupSlider('slider-gig-payout', 'val-gig-payout', 'gigPayout', 'AED ');
            setupSlider('slider-platform-fee', 'val-platform-fee', 'platformFee', 'AED ');
            setupSlider('slider-founder', 'val-founder', 'founderSalary', 'AED ', true);
            setupSlider('slider-team', 'val-team', 'teamSalaries', 'AED ', true);
            setupSlider('slider-marketing', 'val-marketing', 'marketing', 'AED ', true);
            setupSlider('slider-tech', 'val-tech', 'tech', 'AED ', true);
            setupSlider('slider-office', 'val-office', 'office', 'AED ', true);
            
            // Mobile toggle
            document.getElementById('mobile-toggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });
            
            // Projection view toggle
            document.querySelectorAll('.proj-view-btn').forEach(b => {
                b.addEventListener('click', () => {
                    document.querySelectorAll('.proj-view-btn').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    document.getElementById('proj-summary').classList.toggle('hidden', b.dataset.view !== 'summary');
                    document.getElementById('proj-detailed').classList.toggle('hidden', b.dataset.view !== 'detailed');
                });
            });
            
            // Multi-year sliders
            setupMultiYearSlider('slider-y2-growth', 'val-y2-growth', 'y2GrowthRate', '', '%');
            setupMultiYearSlider('slider-y3-growth', 'val-y3-growth', 'y3GrowthRate', '', '%');
            setupMultiYearSlider('slider-churn-improve', 'val-churn-improve', 'churnImprovement', '', '%');
            setupMultiYearSlider('slider-y2-hires', 'val-y2-hires', 'y2Hires', '');
            setupMultiYearSlider('slider-y3-hires', 'val-y3-hires', 'y3Hires', '');
            setupMultiYearSliderK('slider-avg-salary', 'val-avg-salary', 'avgHireSalary');
            setupMultiYearSlider('slider-fixed-growth', 'val-fixed-growth', 'fixedCostGrowth', '', '%');
            setupMultiYearSlider('slider-marketing-growth', 'val-marketing-growth', 'marketingGrowth', '', '%');
            
            updateDashboard();
        });
    </script>
</body>
</html>
